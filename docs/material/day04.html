<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.1.189">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Causal Inference in Social Science@Kandai - Rの復習</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../material/day06.html" rel="next">
<link href="../material/day03.html" rel="prev">
<link href="../figs/favicon.png" rel="icon" type="image/png">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-9F94XL4N4M"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-9F94XL4N4M', { 'anonymize_ip': true});
</script>

<script src="../site_libs/kePrint-0.0.1/kePrint.js"></script>
<link href="../site_libs/lightable-0.0.1/lightable.css" rel="stylesheet">

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-sidebar docked nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a href="../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../figs/logo.png" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Causal Inference in Social Science@Kandai</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../syllabus.html">シラバス</a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-rの使い方" role="button" data-bs-toggle="dropdown" aria-expanded="false">Rの使い方</a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-rの使い方">    
        <li>
    <a class="dropdown-item" href="../intro/install.html">
 <span class="dropdown-text">Rの導入</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../intro/rstudio.html">
 <span class="dropdown-text">RStudioの設定</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../intro/project.html">
 <span class="dropdown-text">プロジェクト管理</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../intro/file.html">
 <span class="dropdown-text">ファイル管理</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../intro/filesystem.html">
 <span class="dropdown-text">ファイル管理術</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../intro/packages.html">
 <span class="dropdown-text">パッケージ</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-" role="button" data-bs-toggle="dropdown" aria-expanded="false">講義資料</a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-">    
        <li>
    <a class="dropdown-item" href="../material/day01.html">
 <span class="dropdown-text">ガイダンス</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../material/day02.html">
 <span class="dropdown-text">因果推論の考え方</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../material/day03.html">
 <span class="dropdown-text">無作為化比較試験</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../material/day04.html">
 <span class="dropdown-text">Rの復習</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../material/day06.html">
 <span class="dropdown-text">回帰分析と因果推論</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../material/day07.html">
 <span class="dropdown-text">マッチング</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../material/day09.html">
 <span class="dropdown-text">差分の差分法</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../material/day11.html">
 <span class="dropdown-text">回帰不連続デザイン</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../material/day13.html">
 <span class="dropdown-text">操作変数法</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="../data.html">データ集</a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://jupyter.cs.rcos.nii.ac.jp/"><i class="bi bi-terminal" role="img">
</i> 
 </a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.jaysong.net/RBook/"><i class="bi bi-book" role="img">
</i> 
 </a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title">Rの復習</h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation docked overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../material/day01.html" class="sidebar-item-text sidebar-link">ガイダンス</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../material/day02.html" class="sidebar-item-text sidebar-link">因果推論の考え方</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../material/day03.html" class="sidebar-item-text sidebar-link">無作為化比較試験</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../material/day04.html" class="sidebar-item-text sidebar-link active">Rの復習</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../material/day06.html" class="sidebar-item-text sidebar-link">回帰分析と因果推論</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../material/day07.html" class="sidebar-item-text sidebar-link">マッチング</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../material/day09.html" class="sidebar-item-text sidebar-link">差分の差分法</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../material/day11.html" class="sidebar-item-text sidebar-link">回帰不連続デザイン</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../material/day13.html" class="sidebar-item-text sidebar-link">操作変数法</a>
  </div>
</li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">目次</h2>
   
  <ul>
  <li><a href="#パッケージ" id="toc-パッケージ" class="nav-link active" data-scroll-target="#パッケージ">パッケージ</a></li>
  <li><a href="#データの読み込みと確認" id="toc-データの読み込みと確認" class="nav-link" data-scroll-target="#データの読み込みと確認">データの読み込みと確認</a></li>
  <li><a href="#データハンドリングとパイプ演算子" id="toc-データハンドリングとパイプ演算子" class="nav-link" data-scroll-target="#データハンドリングとパイプ演算子">データハンドリングとパイプ演算子</a></li>
  <li><a href="#記述統計量" id="toc-記述統計量" class="nav-link" data-scroll-target="#記述統計量">記述統計量</a></li>
  <li><a href="#バランスチェック" id="toc-バランスチェック" class="nav-link" data-scroll-target="#バランスチェック">バランスチェック</a></li>
  <li><a href="#処置効果の確認" id="toc-処置効果の確認" class="nav-link" data-scroll-target="#処置効果の確認">処置効果の確認</a>
  <ul class="collapse">
  <li><a href="#グループごとの応答変数の平均値" id="toc-グループごとの応答変数の平均値" class="nav-link" data-scroll-target="#グループごとの応答変数の平均値">グループごとの応答変数の平均値</a></li>
  <li><a href="#統計的推定単回帰分析" id="toc-統計的推定単回帰分析" class="nav-link" data-scroll-target="#統計的推定単回帰分析">統計的推定（単回帰分析）</a></li>
  <li><a href="#多重比較の問題" id="toc-多重比較の問題" class="nav-link" data-scroll-target="#多重比較の問題">多重比較の問題</a></li>
  <li><a href="#統計的推定重回帰分析" id="toc-統計的推定重回帰分析" class="nav-link" data-scroll-target="#統計的推定重回帰分析">統計的推定（重回帰分析）</a></li>
  </ul></li>
  <li><a href="#番外編" id="toc-番外編" class="nav-link" data-scroll-target="#番外編">番外編</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title d-none d-lg-block">Rの復習</h1>
</div>



<div class="quarto-title-meta">

    
    
  </div>
  

</header>

<section id="パッケージ" class="level2">
<h2 class="anchored" data-anchor-id="パッケージ">パッケージ</h2>
<p>　通常、Rでのパッケージのインストールとアップーでとには<code>install.packages()</code>関数、読み込みには<code>library()</code>、または<code>require()</code>関数を使う。また、R公式レポジトリにないパッケージは{devtools}か{remote}パッケージを使う。これらの関数を使い分けることは面倒なので、本講義ではこれらの処理を統合した{pacman}パッケージを使用する。まずは、{pacman}パッケージをインストールする。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="co"># NIIオンライン分析システムを利用する場合、導入済み</span></span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="fu">install.packages</span>(<span class="st">"pacman"</span>)</span></code><button title="コピーする" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>　パッケージを読み込む際、<code>pacman::p_load(読み込むパッケージ名)</code>を入力する。インストールされていない場合は、自動的に<a href="https://cran.r-project.org/">CRAN</a>からダウンロード&amp;インストールした上で読み込んでくれるので便利だ<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>。以下では本講義で使用するパッケージとして{tidyverse}、{summarytools}、{fastDummies}、{modelsummary}を読み込む。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(tidyverse, summarytools, fastDummies,</span>
<span id="cb2-2"><a href="#cb2-2"></a>               modelsummary, broom)</span></code><button title="コピーする" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>　<a href="https://cran.r-project.org/">CRAN</a>でなく、<a href="https://github.com/">GitHub</a>上で公開されているパッケージを使う場合は<code>pacman::p_load_gh()</code>を使用する。<code>()</code>の中には<code>"ユーザー名/リポジトリ名"</code>を入力。たとえば、{BalanceR}の<a href="https://www.jaysong.net">作成者</a>の<a href="https://github.com/">GitHub</a>アカウント名は<code>JaehyunSong</code>であり、{BalanceR}のリポジトリ名は<code>BalanceR</code>だから、以下のように入力する。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a>pacman<span class="sc">::</span><span class="fu">p_load_gh</span>(<span class="st">"JaehyunSong/BalanceR"</span>)</span></code><button title="コピーする" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="データの読み込みと確認" class="level2">
<h2 class="anchored" data-anchor-id="データの読み込みと確認">データの読み込みと確認</h2>
<p>　<code>.csv</code>形式のデータを読み込むには<code>read_csv()</code>関数を使用する。<code>()</code>内には読み込むファイルのパスを<code>"</code>で囲んで記入する。<code>read_csv()</code>関数はファイルの読み込み<strong>のみ</strong>の機能しか持たない。現在の作業環境内に読み込んだデータを格納するためには代入演算子<code>&lt;-</code>を使う。ここでは<code>data</code>フォルダー内の<code>rct_data.csv</code>を読み込み<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>、<code>raw_df</code>という名のオブジェクトとしてく格納する。作業環境内のオブジェクトはRを再起動すると削除されるため、改めてパッケージ/データの読み込みが必要だ。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a>raw_df <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/rct_data.csv"</span>)</span></code><button title="コピーする" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 5000 Columns: 8
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr (6): treatment, gender, voted2000, voted2002, voted2004, voted2006
dbl (2): yob, hh_size

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
</div>
<p>　オブジェクトの中身を出力するためにはオブジェクト名を入力する。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a>raw_df</span></code><button title="コピーする" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5,000 × 8
   treatment  gender   yob hh_size voted2000 voted2002 voted2004 voted2006
   &lt;chr&gt;      &lt;chr&gt;  &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;    
 1 Hawthorne  female  1955       1 no        yes       no        no       
 2 Hawthorne  male    1969       2 no        yes       no        no       
 3 Control    female  1944       2 no        no        no        no       
 4 Control    male    1974       2 no        no        yes       no       
 5 Neighbors  female  1969       2 no        no        yes       no       
 6 Control    male    1942       1 no        yes       no        no       
 7 Civic Duty male    1969       2 yes       no        no        no       
 8 Hawthorne  male    1966       2 no        yes       no        yes      
 9 Control    male    1949       2 no        yes       yes       no       
10 Control    female  1958       2 no        yes       no        no       
# … with 4,990 more rows</code></pre>
</div>
</div>
<p>　表形式データの大きさ（行の列の数）の確認には<code>dim()</code>関数を使う。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a><span class="fu">dim</span>(raw_df)</span></code><button title="コピーする" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 5000    8</code></pre>
</div>
</div>
<p>　表形式データの場合、各列には名前が付いており、それぞれが一つの変数に該当する。これら変数名のみの出力には<code>names()</code>関数を使う。今回のデータだと、列の数が少ないこともあり、一画面に全列が表示されるが、数百列のデータとなると画面に収まらないので、変数名を確認しておくことを推奨する。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a><span class="fu">names</span>(raw_df)</span></code><button title="コピーする" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "treatment" "gender"    "yob"       "hh_size"   "voted2000" "voted2002"
[7] "voted2004" "voted2006"</code></pre>
</div>
</div>
</section>
<section id="データハンドリングとパイプ演算子" class="level2">
<h2 class="anchored" data-anchor-id="データハンドリングとパイプ演算子">データハンドリングとパイプ演算子</h2>
<p>　パイプ演算子には{magrittr}パッケージが提供する<code>%&gt;%</code>とR 4.1から提供されるネイティブパイプ演算子の<code>|&gt;</code>がある。現在の主流は古くから使われてきた<code>%&gt;%</code>であるが、今後、<code>|&gt;</code>が主流になると考えられるため、本講義では<code>|&gt;</code>を使用する。しかし、多くの場合、<code>|&gt;</code>の代わりに<code>%&gt;%</code>を使っても同じ結果が得られる。</p>
<p>　パイプ演算子はパイプ前のオブジェクトを、パイプ後の関数の<strong>第一引数</strong>として渡す単純な演算子だ。たとえば、列名を変更する関数は<code>rename()</code>であるが、使い方は<code>renames(データ名, 新しい列名 = 既存の列名, ...)</code>である。<code>raw_df</code>の<code>gender</code>列の名前を<code>female</code>に変更する場合は以下のように書く。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a><span class="fu">rename</span>(raw_df, <span class="at">female =</span> gender)</span></code><button title="コピーする" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5,000 × 8
   treatment  female   yob hh_size voted2000 voted2002 voted2004 voted2006
   &lt;chr&gt;      &lt;chr&gt;  &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;    
 1 Hawthorne  female  1955       1 no        yes       no        no       
 2 Hawthorne  male    1969       2 no        yes       no        no       
 3 Control    female  1944       2 no        no        no        no       
 4 Control    male    1974       2 no        no        yes       no       
 5 Neighbors  female  1969       2 no        no        yes       no       
 6 Control    male    1942       1 no        yes       no        no       
 7 Civic Duty male    1969       2 yes       no        no        no       
 8 Hawthorne  male    1966       2 no        yes       no        yes      
 9 Control    male    1949       2 no        yes       yes       no       
10 Control    female  1958       2 no        yes       no        no       
# … with 4,990 more rows</code></pre>
</div>
</div>
<p>　ここで第1引数が<code>raw_df</code>だが、パイプ演算子を使うと以下のようになり、人間にとって読みやすいコードになる。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a>raw_df <span class="sc">|&gt;</span></span>
<span id="cb14-2"><a href="#cb14-2"></a>  <span class="fu">rename</span>(<span class="at">female =</span> gender)</span></code><button title="コピーする" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5,000 × 8
   treatment  female   yob hh_size voted2000 voted2002 voted2004 voted2006
   &lt;chr&gt;      &lt;chr&gt;  &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;    
 1 Hawthorne  female  1955       1 no        yes       no        no       
 2 Hawthorne  male    1969       2 no        yes       no        no       
 3 Control    female  1944       2 no        no        no        no       
 4 Control    male    1974       2 no        no        yes       no       
 5 Neighbors  female  1969       2 no        no        yes       no       
 6 Control    male    1942       1 no        yes       no        no       
 7 Civic Duty male    1969       2 yes       no        no        no       
 8 Hawthorne  male    1966       2 no        yes       no        yes      
 9 Control    male    1949       2 no        yes       yes       no       
10 Control    female  1958       2 no        yes       no        no       
# … with 4,990 more rows</code></pre>
</div>
</div>
<p>　要するに、<code>X |&gt; Y</code>は「<code>X</code>（の結果）を使って<code>Y</code>を行う」ことを意味する。</p>
<p>　続いて、変数のリコーディングをしてみよう。<code>x</code>の値が<code>"A"</code>なら1、それ以外は0のように、戻り値が2種類の場合のリコーディングには<code>if_else()</code>を使用する。書き方は以下の通りだ。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a><span class="fu">if_else</span>(条件式, 条件が満たされる場合の戻り値, 条件が満たされない場合の戻り値)</span></code><button title="コピーする" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>　たとえば、<code>raw_df</code>の<code>gender</code>列の値が<code>"female"</code>なら1、それ以外なら0とし、その結果を<code>female</code>列として追加するコードは以下の通り。同値を意味する演算子が<code>=</code>でなく、<code>==</code>であることに注意すること（<code>=</code>は<code>&lt;-</code>と同じ代入演算子であるが、Rでは代入演算子として<code>=</code>より<code>&lt;-</code>の使用を推奨している）。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a><span class="fu">mutate</span>(raw_df, </span>
<span id="cb17-2"><a href="#cb17-2"></a>       <span class="at">female =</span> <span class="fu">if_else</span>(gender <span class="sc">==</span> <span class="st">"female"</span>, <span class="dv">1</span>, <span class="dv">0</span>))</span></code><button title="コピーする" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5,000 × 9
   treatment  gender   yob hh_size voted2000 voted2002 voted2004 voted2…¹ female
   &lt;chr&gt;      &lt;chr&gt;  &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;     &lt;dbl&gt;
 1 Hawthorne  female  1955       1 no        yes       no        no            1
 2 Hawthorne  male    1969       2 no        yes       no        no            0
 3 Control    female  1944       2 no        no        no        no            1
 4 Control    male    1974       2 no        no        yes       no            0
 5 Neighbors  female  1969       2 no        no        yes       no            1
 6 Control    male    1942       1 no        yes       no        no            0
 7 Civic Duty male    1969       2 yes       no        no        no            0
 8 Hawthorne  male    1966       2 no        yes       no        yes           0
 9 Control    male    1949       2 no        yes       yes       no            0
10 Control    female  1958       2 no        yes       no        no            1
# … with 4,990 more rows, and abbreviated variable name ¹​voted2006</code></pre>
</div>
</div>
<p>　<code>mutate()</code>は指定された列に対して何らかの処理を行い、その結果を新しい列として追加するか、上書きする関数である。この<code>mutate()</code>関数の第1引数もデータであるため、以下のようにパイプ演算子を使うこともできる。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1"></a>raw_df <span class="sc">|&gt;</span></span>
<span id="cb19-2"><a href="#cb19-2"></a>  <span class="fu">mutate</span>(<span class="at">female =</span> <span class="fu">if_else</span>(gender <span class="sc">==</span> <span class="st">"female"</span>, <span class="dv">1</span>, <span class="dv">0</span>))</span></code><button title="コピーする" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5,000 × 9
   treatment  gender   yob hh_size voted2000 voted2002 voted2004 voted2…¹ female
   &lt;chr&gt;      &lt;chr&gt;  &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;     &lt;dbl&gt;
 1 Hawthorne  female  1955       1 no        yes       no        no            1
 2 Hawthorne  male    1969       2 no        yes       no        no            0
 3 Control    female  1944       2 no        no        no        no            1
 4 Control    male    1974       2 no        no        yes       no            0
 5 Neighbors  female  1969       2 no        no        yes       no            1
 6 Control    male    1942       1 no        yes       no        no            0
 7 Civic Duty male    1969       2 yes       no        no        no            0
 8 Hawthorne  male    1966       2 no        yes       no        yes           0
 9 Control    male    1949       2 no        yes       yes       no            0
10 Control    female  1958       2 no        yes       no        no            1
# … with 4,990 more rows, and abbreviated variable name ¹​voted2006</code></pre>
</div>
</div>
<p>　また、<code>mutate()</code>内には複数のコードを書くこともできる。<code>voted2000</code>列から<code>voted2006</code>列までそれぞれの値が<code>"yes"</code>であれば、1を、それ以外の場合は0にリコーディングしてみよう。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1"></a>raw_df <span class="sc">|&gt;</span></span>
<span id="cb21-2"><a href="#cb21-2"></a>  <span class="fu">mutate</span>(<span class="at">female    =</span> <span class="fu">if_else</span>(gender    <span class="sc">==</span> <span class="st">"female"</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb21-3"><a href="#cb21-3"></a>         <span class="at">voted2000 =</span> <span class="fu">if_else</span>(voted2000 <span class="sc">==</span> <span class="st">"yes"</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb21-4"><a href="#cb21-4"></a>         <span class="at">voted2002 =</span> <span class="fu">if_else</span>(voted2002 <span class="sc">==</span> <span class="st">"yes"</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb21-5"><a href="#cb21-5"></a>         <span class="at">voted2004 =</span> <span class="fu">if_else</span>(voted2004 <span class="sc">==</span> <span class="st">"yes"</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb21-6"><a href="#cb21-6"></a>         <span class="at">voted2006 =</span> <span class="fu">if_else</span>(voted2006 <span class="sc">==</span> <span class="st">"yes"</span>, <span class="dv">1</span>, <span class="dv">0</span>))</span></code><button title="コピーする" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5,000 × 9
   treatment  gender   yob hh_size voted2000 voted2002 voted2004 voted2…¹ female
   &lt;chr&gt;      &lt;chr&gt;  &lt;dbl&gt;   &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;
 1 Hawthorne  female  1955       1         0         1         0        0      1
 2 Hawthorne  male    1969       2         0         1         0        0      0
 3 Control    female  1944       2         0         0         0        0      1
 4 Control    male    1974       2         0         0         1        0      0
 5 Neighbors  female  1969       2         0         0         1        0      1
 6 Control    male    1942       1         0         1         0        0      0
 7 Civic Duty male    1969       2         1         0         0        0      0
 8 Hawthorne  male    1966       2         0         1         0        1      0
 9 Control    male    1949       2         0         1         1        0      0
10 Control    female  1958       2         0         1         0        0      1
# … with 4,990 more rows, and abbreviated variable name ¹​voted2006</code></pre>
</div>
</div>
<p>　また、パイプ演算子は2つ以上使うこともできる。たとえば、<code>rename()</code>を使って<code>gender</code>列を<code>female</code>に変更し、<code>mutate()</code>でリコーディングを行う場合、以下のように書く。これは<code>raw_df</code>を使って<code>rename()</code>の処理を行い、その結果を<code>mutate()</code>関数のデータとして渡すことを意味する。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1"></a>raw_df <span class="sc">|&gt;</span></span>
<span id="cb23-2"><a href="#cb23-2"></a>  <span class="fu">rename</span>(<span class="at">female =</span> gender) <span class="sc">|&gt;</span></span>
<span id="cb23-3"><a href="#cb23-3"></a>  <span class="fu">mutate</span>(<span class="at">female    =</span> <span class="fu">if_else</span>(female    <span class="sc">==</span> <span class="st">"female"</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb23-4"><a href="#cb23-4"></a>         <span class="at">voted2000 =</span> <span class="fu">if_else</span>(voted2000 <span class="sc">==</span> <span class="st">"yes"</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb23-5"><a href="#cb23-5"></a>         <span class="at">voted2002 =</span> <span class="fu">if_else</span>(voted2002 <span class="sc">==</span> <span class="st">"yes"</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb23-6"><a href="#cb23-6"></a>         <span class="at">voted2004 =</span> <span class="fu">if_else</span>(voted2004 <span class="sc">==</span> <span class="st">"yes"</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb23-7"><a href="#cb23-7"></a>         <span class="at">voted2006 =</span> <span class="fu">if_else</span>(voted2006 <span class="sc">==</span> <span class="st">"yes"</span>, <span class="dv">1</span>, <span class="dv">0</span>))</span></code><button title="コピーする" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5,000 × 8
   treatment  female   yob hh_size voted2000 voted2002 voted2004 voted2006
   &lt;chr&gt;       &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
 1 Hawthorne       1  1955       1         0         1         0         0
 2 Hawthorne       0  1969       2         0         1         0         0
 3 Control         1  1944       2         0         0         0         0
 4 Control         0  1974       2         0         0         1         0
 5 Neighbors       1  1969       2         0         0         1         0
 6 Control         0  1942       1         0         1         0         0
 7 Civic Duty      0  1969       2         1         0         0         0
 8 Hawthorne       0  1966       2         0         1         0         1
 9 Control         0  1949       2         0         1         1         0
10 Control         1  1958       2         0         1         0         0
# … with 4,990 more rows</code></pre>
</div>
</div>
<p>　以上のコードはデータを加工し、その結果を<strong>出力するだけ</strong>であって、その結果を保存しない。もう一度<code>raw_df</code>を出力してみても、これまでのデータ加工内容は反映されていないことが分かる。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1"></a>raw_df</span></code><button title="コピーする" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5,000 × 8
   treatment  gender   yob hh_size voted2000 voted2002 voted2004 voted2006
   &lt;chr&gt;      &lt;chr&gt;  &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;    
 1 Hawthorne  female  1955       1 no        yes       no        no       
 2 Hawthorne  male    1969       2 no        yes       no        no       
 3 Control    female  1944       2 no        no        no        no       
 4 Control    male    1974       2 no        no        yes       no       
 5 Neighbors  female  1969       2 no        no        yes       no       
 6 Control    male    1942       1 no        yes       no        no       
 7 Civic Duty male    1969       2 yes       no        no        no       
 8 Hawthorne  male    1966       2 no        yes       no        yes      
 9 Control    male    1949       2 no        yes       yes       no       
10 Control    female  1958       2 no        yes       no        no       
# … with 4,990 more rows</code></pre>
</div>
</div>
<p>　このように頑張ってデータを加工したもののその結果が全く反映されていない。加工したデータを引き続き使っていくためには、加工結果を作業環境内に保存する必要がある。作業環境内にオブジェクトを保存するためには代入演算子（<code>&lt;-</code>）を使い、名前を付けて作業空間内に保存する（ファイルとして保存されるわけではない）必要がある。今回は加工の結果を<code>df</code>という名で保存する。<code>raw_df</code>に上書きしても問題はないが、生データはとりあえず作業空間内に残しておくことを推奨する（Rに慣れれば上書きしても良い）。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1"></a>df <span class="ot">&lt;-</span> raw_df <span class="sc">|&gt;</span></span>
<span id="cb27-2"><a href="#cb27-2"></a>  <span class="fu">rename</span>(<span class="at">female =</span> gender) <span class="sc">|&gt;</span></span>
<span id="cb27-3"><a href="#cb27-3"></a>  <span class="fu">mutate</span>(<span class="at">female    =</span> <span class="fu">if_else</span>(female    <span class="sc">==</span> <span class="st">"female"</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb27-4"><a href="#cb27-4"></a>         <span class="at">voted2000 =</span> <span class="fu">if_else</span>(voted2000 <span class="sc">==</span> <span class="st">"yes"</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb27-5"><a href="#cb27-5"></a>         <span class="at">voted2002 =</span> <span class="fu">if_else</span>(voted2002 <span class="sc">==</span> <span class="st">"yes"</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb27-6"><a href="#cb27-6"></a>         <span class="at">voted2004 =</span> <span class="fu">if_else</span>(voted2004 <span class="sc">==</span> <span class="st">"yes"</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb27-7"><a href="#cb27-7"></a>         <span class="at">voted2006 =</span> <span class="fu">if_else</span>(voted2006 <span class="sc">==</span> <span class="st">"yes"</span>, <span class="dv">1</span>, <span class="dv">0</span>))</span>
<span id="cb27-8"><a href="#cb27-8"></a></span>
<span id="cb27-9"><a href="#cb27-9"></a>df</span></code><button title="コピーする" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5,000 × 8
   treatment  female   yob hh_size voted2000 voted2002 voted2004 voted2006
   &lt;chr&gt;       &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
 1 Hawthorne       1  1955       1         0         1         0         0
 2 Hawthorne       0  1969       2         0         1         0         0
 3 Control         1  1944       2         0         0         0         0
 4 Control         0  1974       2         0         0         1         0
 5 Neighbors       1  1969       2         0         0         1         0
 6 Control         0  1942       1         0         1         0         0
 7 Civic Duty      0  1969       2         1         0         0         0
 8 Hawthorne       0  1966       2         0         1         0         1
 9 Control         0  1949       2         0         1         1         0
10 Control         1  1958       2         0         1         0         0
# … with 4,990 more rows</code></pre>
</div>
</div>
<p>　ちなみに、<code>across()</code>関数とラムダ式（無名関数）を組み合わせると以上のコードをより効率的に書くこともできる。<code>across()</code>は強力な関数だが、初心者にはやや難しいかも知れない。詳細は『私たちのR』の<a href="https://www.jaysong.net/RBook/datahandling2.html#handling2-summarise">第13.1章</a>を参照されたい。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1"></a>df <span class="ot">&lt;-</span> raw_df <span class="sc">|&gt;</span></span>
<span id="cb29-2"><a href="#cb29-2"></a>  <span class="fu">rename</span>(<span class="at">female =</span> gender) <span class="sc">|&gt;</span></span>
<span id="cb29-3"><a href="#cb29-3"></a>  <span class="fu">mutate</span>(<span class="at">female =</span> <span class="fu">if_else</span>(female <span class="sc">==</span> <span class="st">"female"</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb29-4"><a href="#cb29-4"></a>         <span class="co"># 第1引数: votedで始まる変数を対象に処理を行う</span></span>
<span id="cb29-5"><a href="#cb29-5"></a>         <span class="co"># 第2引数: 当該変数の値が"yes"なら1、それ以外なら0を割り当てる無名関数</span></span>
<span id="cb29-6"><a href="#cb29-6"></a>         <span class="co">#          無名関数は「~」で始まり、変数が入る箇所は.xと表記する</span></span>
<span id="cb29-7"><a href="#cb29-7"></a>         <span class="co">#          引数が当該変数のみであれば、「~」を付けずに関数のみでもOK</span></span>
<span id="cb29-8"><a href="#cb29-8"></a>         <span class="fu">across</span>(<span class="fu">starts_with</span>(<span class="st">"voted"</span>), <span class="sc">~</span><span class="fu">if_else</span>(.x <span class="sc">==</span> <span class="st">"yes"</span>, <span class="dv">1</span>, <span class="dv">0</span>)))</span></code><button title="コピーする" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="記述統計量" class="level2">
<h2 class="anchored" data-anchor-id="記述統計量">記述統計量</h2>
<p>　記述統計量の計算には{summarytools}の<code>descr()</code>関数が便利だ。<code>descr(データ名)</code>を入力するだけで各変数の記述統計量が出力される。実際にやってみると分かるが、情報量がかなり多い。しかし、実際の論文では各変数の歪度や尖度まで報告することはあまりないだろう。ここでは<code>stats</code>引数を追加して、論文などでよく使う平均値（<code>"mean"</code>）、標準偏差（<code>"sd"</code>）、最小値（<code>"min"</code>）、最大値（<code>"max"</code>）、有効ケース数（<code>"n.valid"</code>）のみ出力する。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1"></a><span class="co"># descr()の第一引数は表形式データのオブジェクト名であるため、</span></span>
<span id="cb30-2"><a href="#cb30-2"></a><span class="co"># オブジェクト名 |&gt; descr() </span></span>
<span id="cb30-3"><a href="#cb30-3"></a><span class="co"># のような書き方でもOK</span></span>
<span id="cb30-4"><a href="#cb30-4"></a>df <span class="sc">|&gt;</span></span>
<span id="cb30-5"><a href="#cb30-5"></a>  <span class="fu">descr</span>(<span class="at">stats =</span> <span class="fu">c</span>(<span class="st">"mean"</span>, <span class="st">"sd"</span>, <span class="st">"min"</span>, <span class="st">"max"</span>, <span class="st">"n.valid"</span>))</span></code><button title="コピーする" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Non-numerical variable(s) ignored: treatment</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Descriptive Statistics  
df  
N: 5000  

                 female   hh_size   voted2000   voted2002   voted2004   voted2006       yob
------------- --------- --------- ----------- ----------- ----------- ----------- ---------
         Mean      0.50      2.18        0.26        0.39        0.41        0.33   1955.75
      Std.Dev      0.50      0.79        0.44        0.49        0.49        0.47     14.41
          Min      0.00      1.00        0.00        0.00        0.00        0.00   1910.00
          Max      1.00      6.00        1.00        1.00        1.00        1.00   1986.00
      N.Valid   5000.00   5000.00     5000.00     5000.00     5000.00     5000.00   5000.00</code></pre>
</div>
</div>
<p>　ただし、<code>descr()</code>を使うと数値型（numeric）変数の記述統計量のみ表示される。<code>df</code>だと、<code>treatment</code>列は文字型（character）であるため、表示されない<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a>。各グループがサンプルの何割かを計算するためには、<code>treatment</code>変数をダミー変数へ変換する必要がある。ダミー変数の作成は面倒な作業であるが、{fastDummies}パッケージの<code>dummy_cols()</code>を使えば簡単にできる。<code>dummy_cols()</code>の中には<code>select_columns = "ダミー化する列名"</code>を入れれば、当該変数をダミー変数へ変換し、新しい列として追加してくれる。それでは<code>treatment</code>列をダミー化&amp;追加し、その結果を<code>df</code>に上書きしてみよう。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1"></a>df <span class="ot">&lt;-</span> df <span class="sc">|&gt;</span></span>
<span id="cb33-2"><a href="#cb33-2"></a>  <span class="fu">dummy_cols</span>(<span class="at">select_columns =</span> <span class="st">"treatment"</span>)</span>
<span id="cb33-3"><a href="#cb33-3"></a></span>
<span id="cb33-4"><a href="#cb33-4"></a>df</span></code><button title="コピーする" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5,000 × 13
   treatm…¹ female   yob hh_size voted…² voted…³ voted…⁴ voted…⁵ treat…⁶ treat…⁷
   &lt;chr&gt;     &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;int&gt;   &lt;int&gt;
 1 Hawthor…      1  1955       1       0       1       0       0       0       0
 2 Hawthor…      0  1969       2       0       1       0       0       0       0
 3 Control       1  1944       2       0       0       0       0       0       1
 4 Control       0  1974       2       0       0       1       0       0       1
 5 Neighbo…      1  1969       2       0       0       1       0       0       0
 6 Control       0  1942       1       0       1       0       0       0       1
 7 Civic D…      0  1969       2       1       0       0       0       1       0
 8 Hawthor…      0  1966       2       0       1       0       1       0       0
 9 Control       0  1949       2       0       1       1       0       0       1
10 Control       1  1958       2       0       1       0       0       0       1
# … with 4,990 more rows, 3 more variables: treatment_Hawthorne &lt;int&gt;,
#   treatment_Neighbors &lt;int&gt;, treatment_Self &lt;int&gt;, and abbreviated variable
#   names ¹​treatment, ²​voted2000, ³​voted2002, ⁴​voted2004, ⁵​voted2006,
#   ⁶​`treatment_Civic Duty`, ⁷​treatment_Control</code></pre>
</div>
</div>
<p>　画面には表示されないが、出力結果の下段を見ると<code>treatment_</code>で始まるいくつかの変数が追加されたことが分かる。ここでは<code>"tretmant"</code>で始まる列のみを抽出つして確認してみよう。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1"></a>df <span class="sc">|&gt;</span></span>
<span id="cb35-2"><a href="#cb35-2"></a>  <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">"treatment"</span>))</span></code><button title="コピーする" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5,000 × 6
   treatment  `treatment_Civic Duty` treatment_Control treatme…¹ treat…² treat…³
   &lt;chr&gt;                       &lt;int&gt;             &lt;int&gt;     &lt;int&gt;   &lt;int&gt;   &lt;int&gt;
 1 Hawthorne                       0                 0         1       0       0
 2 Hawthorne                       0                 0         1       0       0
 3 Control                         0                 1         0       0       0
 4 Control                         0                 1         0       0       0
 5 Neighbors                       0                 0         0       1       0
 6 Control                         0                 1         0       0       0
 7 Civic Duty                      1                 0         0       0       0
 8 Hawthorne                       0                 0         1       0       0
 9 Control                         0                 1         0       0       0
10 Control                         0                 1         0       0       0
# … with 4,990 more rows, and abbreviated variable names ¹​treatment_Hawthorne,
#   ²​treatment_Neighbors, ³​treatment_Self</code></pre>
</div>
</div>
<p>　<code>select()</code>関数内には抽出する列名を入力するだけで良い。たとえば、<code>female</code>と<code>yob</code>列を抽出するなら<code>select(female, yob)</code>である。また、<code>female</code><strong>から</strong><code>voted2006</code><strong>まで</strong>の意味で<code>female:voted2006</code>のような書き方もできる。他にも上の例のように<code>starts_with()</code>や<code>ends_with()</code>、<code>contain()</code>を使って特定の文字列で始まる（で終わる、を含む）列を指定することもできる。一部の列を除外する場合は変数名の前に<code>!</code>か<code>-</code>を付ける。</p>
<p>　とにかく、問題なくダミー化されていることが分かる。もう一度記述統計量を出してみよう。<code>descr()</code>は仕様上、出力される変数の順番はアルファベット順になるが、ここでは元の順番を維持するために<code>order = "p"</code>を追加する。また、通常の記述統計表が、先ほど見たものとは違って、各行が変数を、列は記述統計量を表す場合が多い。このように行と列を交換するためには<code>transpose = TRUE</code>を追加する<a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a>。</p>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1"></a>df <span class="sc">|&gt;</span></span>
<span id="cb37-2"><a href="#cb37-2"></a>  <span class="fu">descr</span>(<span class="at">stats =</span> <span class="fu">c</span>(<span class="st">"mean"</span>, <span class="st">"sd"</span>, <span class="st">"min"</span>, <span class="st">"max"</span>, <span class="st">"n.valid"</span>),</span>
<span id="cb37-3"><a href="#cb37-3"></a>        <span class="at">order =</span> <span class="st">"p"</span>, <span class="at">transpose =</span> <span class="cn">TRUE</span>, <span class="at">headings =</span> <span class="cn">FALSE</span>)</span></code><button title="コピーする" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>Non-numerical variable(s) ignored: treatment</code></pre>
<table class="table">
<thead>
<tr class="header">
<th></th>
<th style="text-align: right;">Mean</th>
<th style="text-align: right;">Std.Dev</th>
<th style="text-align: right;">Min</th>
<th style="text-align: right;">Max</th>
<th style="text-align: right;">N.Valid</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>female</td>
<td style="text-align: right;">0.50</td>
<td style="text-align: right;">0.50</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">5000.00</td>
</tr>
<tr class="even">
<td>yob</td>
<td style="text-align: right;">1955.75</td>
<td style="text-align: right;">14.41</td>
<td style="text-align: right;">1910.00</td>
<td style="text-align: right;">1986.00</td>
<td style="text-align: right;">5000.00</td>
</tr>
<tr class="odd">
<td>hh_size</td>
<td style="text-align: right;">2.18</td>
<td style="text-align: right;">0.79</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">6.00</td>
<td style="text-align: right;">5000.00</td>
</tr>
<tr class="even">
<td>voted2000</td>
<td style="text-align: right;">0.26</td>
<td style="text-align: right;">0.44</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">5000.00</td>
</tr>
<tr class="odd">
<td>voted2002</td>
<td style="text-align: right;">0.39</td>
<td style="text-align: right;">0.49</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">5000.00</td>
</tr>
<tr class="even">
<td>voted2004</td>
<td style="text-align: right;">0.41</td>
<td style="text-align: right;">0.49</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">5000.00</td>
</tr>
<tr class="odd">
<td>voted2006</td>
<td style="text-align: right;">0.33</td>
<td style="text-align: right;">0.47</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">5000.00</td>
</tr>
<tr class="even">
<td>treatment_Civic Duty</td>
<td style="text-align: right;">0.12</td>
<td style="text-align: right;">0.32</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">5000.00</td>
</tr>
<tr class="odd">
<td>treatment_Control</td>
<td style="text-align: right;">0.56</td>
<td style="text-align: right;">0.50</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">5000.00</td>
</tr>
<tr class="even">
<td>treatment_Hawthorne</td>
<td style="text-align: right;">0.11</td>
<td style="text-align: right;">0.32</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">5000.00</td>
</tr>
<tr class="odd">
<td>treatment_Neighbors</td>
<td style="text-align: right;">0.11</td>
<td style="text-align: right;">0.31</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">5000.00</td>
</tr>
<tr class="even">
<td>treatment_Self</td>
<td style="text-align: right;">0.11</td>
<td style="text-align: right;">0.31</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">5000.00</td>
</tr>
</tbody>
</table>
<p>　他にも以下のように<code>dfSummary()</code>関数を使えば、綺麗な表としてまとめてくれる。しかも文字型、factor型変数の場合も度数分布表を作成してくれるので非常に便利だ。これも{summarytools}パッケージに含まれた機能なので、別途、パッケージを読み込む必要はない。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1"></a>df <span class="sc">|&gt;</span></span>
<span id="cb39-2"><a href="#cb39-2"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">starts_with</span>(<span class="st">"treatment_"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb39-3"><a href="#cb39-3"></a>  <span class="fu">dfSummary</span>(<span class="at">headings =</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span> </span>
<span id="cb39-4"><a href="#cb39-4"></a>  <span class="fu">print</span>(<span class="at">method =</span> <span class="st">"render"</span>, <span class="at">round.digits =</span> <span class="dv">3</span>)</span></code><button title="コピーする" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div class="container st-container">
<table class="table table-striped table-bordered st-table st-table-striped st-table-bordered st-multiline ">
  <thead>
    <tr>
      <th align="center" class="st-protect-top-border"><strong>No</strong></th>
      <th align="center" class="st-protect-top-border"><strong>Variable</strong></th>
      <th align="center" class="st-protect-top-border"><strong>Stats / Values</strong></th>
      <th align="center" class="st-protect-top-border"><strong>Freqs (% of Valid)</strong></th>
      <th align="center" class="st-protect-top-border"><strong>Graph</strong></th>
      <th align="center" class="st-protect-top-border"><strong>Valid</strong></th>
      <th align="center" class="st-protect-top-border"><strong>Missing</strong></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td align="center">1</td>
      <td align="left">treatment
[character]</td>
      <td align="left" style="padding:8;vertical-align:middle"><table style="border-collapse:collapse;border:none;margin:0"><tbody><tr style="background-color:transparent"><td style="padding:0;margin:0;border:0" align="left">1. Civic Duty</td></tr><tr style="background-color:transparent"><td style="padding:0;margin:0;border:0" align="left">2. Control</td></tr><tr style="background-color:transparent"><td style="padding:0;margin:0;border:0" align="left">3. Hawthorne</td></tr><tr style="background-color:transparent"><td style="padding:0;margin:0;border:0" align="left">4. Neighbors</td></tr><tr style="background-color:transparent"><td style="padding:0;margin:0;border:0" align="left">5. Self</td></tr></tbody></table></td>
      <td align="left" style="padding:0;vertical-align:middle"><table style="border-collapse:collapse;border:none;margin:0"><tbody><tr style="background-color:transparent"><td style="padding:0 5px 0 7px;margin:0;border:0" align="right">578</td><td style="padding:0 2px 0 0;border:0;" align="left">(</td><td style="padding:0;border:0" align="right">11.6%</td><td style="padding:0 4px 0 2px;border:0" align="left">)</td></tr><tr style="background-color:transparent"><td style="padding:0 5px 0 7px;margin:0;border:0" align="right">2777</td><td style="padding:0 2px 0 0;border:0;" align="left">(</td><td style="padding:0;border:0" align="right">55.5%</td><td style="padding:0 4px 0 2px;border:0" align="left">)</td></tr><tr style="background-color:transparent"><td style="padding:0 5px 0 7px;margin:0;border:0" align="right">572</td><td style="padding:0 2px 0 0;border:0;" align="left">(</td><td style="padding:0;border:0" align="right">11.4%</td><td style="padding:0 4px 0 2px;border:0" align="left">)</td></tr><tr style="background-color:transparent"><td style="padding:0 5px 0 7px;margin:0;border:0" align="right">535</td><td style="padding:0 2px 0 0;border:0;" align="left">(</td><td style="padding:0;border:0" align="right">10.7%</td><td style="padding:0 4px 0 2px;border:0" align="left">)</td></tr><tr style="background-color:transparent"><td style="padding:0 5px 0 7px;margin:0;border:0" align="right">538</td><td style="padding:0 2px 0 0;border:0;" align="left">(</td><td style="padding:0;border:0" align="right">10.8%</td><td style="padding:0 4px 0 2px;border:0" align="left">)</td></tr></tbody></table></td>
      <td align="left" style="vertical-align:middle;padding:0;background-color:transparent;"><img style="border:none;background-color:transparent;padding:0;max-width:max-content;" src="data:image/png;base64, iVBORw0KGgoAAAANSUhEUgAAAGAAAAB9CAQAAAD32a72AAAAAmJLR0QA/4ePzL8AAAAHdElNRQfmCRABLA0Xghr1AAABDklEQVR42u3aQQrCMBQG4UR6Rw/hefQOnlK3iVLa4GLeL/PtShEykAh5tL9atgu9AAPoBfxqGx8eJw7ErdNLbm1c5ja/uh789Emv/Uv8FjKAZgDNAJoBNANoBtAMoBlA+7iR1btxHenj/bLAdfeUcc3xW8gA2nSI7ymD0uGwLs6FKpj/KeO3kAE0A2gG0AygGUAzgGYAzQBafICDLYKDrUqW50IVvhfaDfB7IQMMyGMAzQCaATQDaAbQDKAZQHMuRHAuVMniXKjaVGhxLlTxiMdvIQNoBtAMoBlAM4BmAM0AmgG0+ADnQgTnQpU4F6LFbyEDaAbQDKAZQDOAZgDNAJoBtPiA/5oLJYrfQgbQ3remHe/HHKTHAAAAJXRFWHRkYXRlOmNyZWF0ZQAyMDIyLTA5LTE2VDAxOjQ0OjEzKzAwOjAwsV6AdgAAACV0RVh0ZGF0ZTptb2RpZnkAMjAyMi0wOS0xNlQwMTo0NDoxMyswMDowMMADOMoAAAA9dEVYdGljYzpjb3B5cmlnaHQAQ29weXJpZ2h0IDIwMDcgQXBwbGUgSW5jLiwgYWxsIHJpZ2h0cyByZXNlcnZlZC6eZtwpAAAAI3RFWHRpY2M6ZGVzY3JpcHRpb24AR2VuZXJpYyBSR0IgUHJvZmlsZRqnOI4AAAAASUVORK5CYII="></td>
      <td align="center">5000
(100.0%)</td>
      <td align="center">0
(0.0%)</td>
    </tr>
    <tr>
      <td align="center">2</td>
      <td align="left">female
[numeric]</td>
      <td align="left" style="padding:8;vertical-align:middle"><table style="border-collapse:collapse;border:none;margin:0"><tbody><tr style="background-color:transparent"><td style="padding:0;margin:0;border:0" align="left">Min  : 0</td></tr><tr style="background-color:transparent"><td style="padding:0;margin:0;border:0" align="left">Mean : 0.5</td></tr><tr style="background-color:transparent"><td style="padding:0;margin:0;border:0" align="left">Max  : 1</td></tr></tbody></table></td>
      <td align="left" style="padding:0;vertical-align:middle"><table style="border-collapse:collapse;border:none;margin:0"><tbody><tr style="background-color:transparent"><td style="padding:0 2px 0 7px;margin:0;border:0" align="right">0</td><td style="padding:0 2px;border:0;" align="left">:</td><td style="padding:0 4px 0 6px;margin:0;border:0" align="right">2494</td><td style="padding:0;border:0" align="left">(</td><td style="padding:0 2px;margin:0;border:0" align="right">49.9%</td><td style="padding:0 4px 0 0;border:0" align="left">)</td></tr><tr style="background-color:transparent"><td style="padding:0 2px 0 7px;margin:0;border:0" align="right">1</td><td style="padding:0 2px;border:0;" align="left">:</td><td style="padding:0 4px 0 6px;margin:0;border:0" align="right">2506</td><td style="padding:0;border:0" align="left">(</td><td style="padding:0 2px;margin:0;border:0" align="right">50.1%</td><td style="padding:0 4px 0 0;border:0" align="left">)</td></tr></tbody></table></td>
      <td align="left" style="vertical-align:middle;padding:0;background-color:transparent;"><img style="border:none;background-color:transparent;padding:0;max-width:max-content;" src="data:image/png;base64, iVBORw0KGgoAAAANSUhEUgAAAFgAAAA3CAQAAAAiPkUwAAAAAmJLR0QA/4ePzL8AAAAHdElNRQfmCRABLA0Xghr1AAAAkklEQVRo3u3YQQqAMAxE0UZ6Rw/hefQOPaVum4obQZMpf3alUN5iKCR2Fq0s0QDA2VL7w5Gy0Jv1rOov12jdLW04y1UCMGDAgAEDBpwqgAEDBjwZeJjp2rtXfoybSC1a85DeKFcJObDr8J5ykVJcV9MvUsaPQK4SgAEDBgwYMOBUAQwYMODJwNqLFIXIVQLw17kAVG8MXHQ8VQoAAAAldEVYdGRhdGU6Y3JlYXRlADIwMjItMDktMTZUMDE6NDQ6MTMrMDA6MDCxXoB2AAAAJXRFWHRkYXRlOm1vZGlmeQAyMDIyLTA5LTE2VDAxOjQ0OjEzKzAwOjAwwAM4ygAAAD10RVh0aWNjOmNvcHlyaWdodABDb3B5cmlnaHQgMjAwNyBBcHBsZSBJbmMuLCBhbGwgcmlnaHRzIHJlc2VydmVkLp5m3CkAAAAjdEVYdGljYzpkZXNjcmlwdGlvbgBHZW5lcmljIFJHQiBQcm9maWxlGqc4jgAAAABJRU5ErkJggg=="></td>
      <td align="center">5000
(100.0%)</td>
      <td align="center">0
(0.0%)</td>
    </tr>
    <tr>
      <td align="center">3</td>
      <td align="left">yob
[numeric]</td>
      <td align="left" style="padding:8;vertical-align:middle"><table style="border-collapse:collapse;border:none;margin:0"><tbody><tr style="background-color:transparent"><td style="padding:0;margin:0;border:0" align="left">Mean (sd) : 1955.8 (14.4)</td></tr><tr style="background-color:transparent"><td style="padding:0;margin:0;border:0" align="left">min ≤ med ≤ max:</td></tr><tr style="background-color:transparent"><td style="padding:0;margin:0;border:0" align="left">1910 ≤ 1956 ≤ 1986</td></tr><tr style="background-color:transparent"><td style="padding:0;margin:0;border:0" align="left">IQR (CV) : 18 (0)</td></tr></tbody></table></td>
      <td align="left" style="vertical-align:middle">76 distinct values</td>
      <td align="left" style="vertical-align:middle;padding:0;background-color:transparent;"><img style="border:none;background-color:transparent;padding:0;max-width:max-content;" src="data:image/png;base64, iVBORw0KGgoAAAANSUhEUgAAAJgAAABuCAQAAABxABKuAAAAAmJLR0QA/4ePzL8AAAAHdElNRQfmCRABLA0Xghr1AAAByUlEQVR42u3cQW6DMBQA0VLljr1De57kDjllunUxijUG27/2vF0WTdEoHxwgbK8PEZ+jN+C/MRhkMOiWvthGb80b94Od7U+nDU7/9a36Xbr72r1+DtkKRxIyGGQwyGCQwaCwR8l70O9sYYPtlxFjFhE5RxIyGGQwyGCQwaAgR8m6RcT+r3qcvQgSrO5cxIiFhyMJGQwyGGQwyGCQwSCDQQaDDAYZDDIYZDDIYJDBIINBBoMMBhkMMhhkMMhgkMEgg0EGgwwGGQwyGGQwyGCQwSCDQUPuD2t1D37+vtffYjfohro2P+Xr8QNBRxIyGGQwyGCQwSCDQQaDDAYZDDIYZDDIYJDBoDA//xuDPzNq8WD8lJAjCRkM6jKSUR8LU6PTPizmY2FqOJKQwSCDQZOvw66/Ujl5sOuvVDqSkMEgg0EGgwwGNThKzvTNMddkWRHjueRtOJKQwaDJV/q5s3vY5YKdPTPnSEKnP2FzLyJyF4zkzIuInCMJGQwyGGQwCO/0Vzsq7lUcJee5KFtjuZV+2cEMJVeaDJZ5v650pw8ZDCqM5OrHxFxxH7bWN8UyRxL68wlzAMu2tNHDYIe+k3XYZiPGfRhkMMhg0C88XDFqxLuxxwAAACV0RVh0ZGF0ZTpjcmVhdGUAMjAyMi0wOS0xNlQwMTo0NDoxMyswMDowMLFegHYAAAAldEVYdGRhdGU6bW9kaWZ5ADIwMjItMDktMTZUMDE6NDQ6MTMrMDA6MDDAAzjKAAAAPXRFWHRpY2M6Y29weXJpZ2h0AENvcHlyaWdodCAyMDA3IEFwcGxlIEluYy4sIGFsbCByaWdodHMgcmVzZXJ2ZWQunmbcKQAAACN0RVh0aWNjOmRlc2NyaXB0aW9uAEdlbmVyaWMgUkdCIFByb2ZpbGUapziOAAAAAElFTkSuQmCC"></td>
      <td align="center">5000
(100.0%)</td>
      <td align="center">0
(0.0%)</td>
    </tr>
    <tr>
      <td align="center">4</td>
      <td align="left">hh_size
[numeric]</td>
      <td align="left" style="padding:8;vertical-align:middle"><table style="border-collapse:collapse;border:none;margin:0"><tbody><tr style="background-color:transparent"><td style="padding:0;margin:0;border:0" align="left">Mean (sd) : 2.2 (0.8)</td></tr><tr style="background-color:transparent"><td style="padding:0;margin:0;border:0" align="left">min ≤ med ≤ max:</td></tr><tr style="background-color:transparent"><td style="padding:0;margin:0;border:0" align="left">1 ≤ 2 ≤ 6</td></tr><tr style="background-color:transparent"><td style="padding:0;margin:0;border:0" align="left">IQR (CV) : 0 (0.4)</td></tr></tbody></table></td>
      <td align="left" style="padding:0;vertical-align:middle"><table style="border-collapse:collapse;border:none;margin:0"><tbody><tr style="background-color:transparent"><td style="padding:0 2px 0 7px;margin:0;border:0" align="right">1</td><td style="padding:0 2px;border:0;" align="left">:</td><td style="padding:0 4px 0 6px;margin:0;border:0" align="right">699</td><td style="padding:0;border:0" align="left">(</td><td style="padding:0 2px;margin:0;border:0" align="right">14.0%</td><td style="padding:0 4px 0 0;border:0" align="left">)</td></tr><tr style="background-color:transparent"><td style="padding:0 2px 0 7px;margin:0;border:0" align="right">2</td><td style="padding:0 2px;border:0;" align="left">:</td><td style="padding:0 4px 0 6px;margin:0;border:0" align="right">3112</td><td style="padding:0;border:0" align="left">(</td><td style="padding:0 2px;margin:0;border:0" align="right">62.2%</td><td style="padding:0 4px 0 0;border:0" align="left">)</td></tr><tr style="background-color:transparent"><td style="padding:0 2px 0 7px;margin:0;border:0" align="right">3</td><td style="padding:0 2px;border:0;" align="left">:</td><td style="padding:0 4px 0 6px;margin:0;border:0" align="right">831</td><td style="padding:0;border:0" align="left">(</td><td style="padding:0 2px;margin:0;border:0" align="right">16.6%</td><td style="padding:0 4px 0 0;border:0" align="left">)</td></tr><tr style="background-color:transparent"><td style="padding:0 2px 0 7px;margin:0;border:0" align="right">4</td><td style="padding:0 2px;border:0;" align="left">:</td><td style="padding:0 4px 0 6px;margin:0;border:0" align="right">308</td><td style="padding:0;border:0" align="left">(</td><td style="padding:0 2px;margin:0;border:0" align="right">6.2%</td><td style="padding:0 4px 0 0;border:0" align="left">)</td></tr><tr style="background-color:transparent"><td style="padding:0 2px 0 7px;margin:0;border:0" align="right">5</td><td style="padding:0 2px;border:0;" align="left">:</td><td style="padding:0 4px 0 6px;margin:0;border:0" align="right">45</td><td style="padding:0;border:0" align="left">(</td><td style="padding:0 2px;margin:0;border:0" align="right">0.9%</td><td style="padding:0 4px 0 0;border:0" align="left">)</td></tr><tr style="background-color:transparent"><td style="padding:0 2px 0 7px;margin:0;border:0" align="right">6</td><td style="padding:0 2px;border:0;" align="left">:</td><td style="padding:0 4px 0 6px;margin:0;border:0" align="right">5</td><td style="padding:0;border:0" align="left">(</td><td style="padding:0 2px;margin:0;border:0" align="right">0.1%</td><td style="padding:0 4px 0 0;border:0" align="left">)</td></tr></tbody></table></td>
      <td align="left" style="vertical-align:middle;padding:0;background-color:transparent;"><img style="border:none;background-color:transparent;padding:0;max-width:max-content;" src="data:image/png;base64, iVBORw0KGgoAAAANSUhEUgAAAGoAAACVCAQAAAAa7KfQAAAAAmJLR0QA/4ePzL8AAAAHdElNRQfmCRABLA0Xghr1AAABRklEQVR42u3bQarCQBQFUSPZo4twPXEPrjJOu1U0rYO8uqkzkw+Swk7Ai39aT3nOe1+AUUeOmtsXt4Eb7Drtfem99tLn/k+XjW9x37vho8jjZxSFURRGURhFYRSFURRGURhFERn19HW+9tf0raZ2sCi2pQxpOyKPX2RUd08t5GG9uXd+3P2q6R9wkcfPKAqjKIyiMIrCKAqjKIyiMIoiMsrdrzJ3P6K/d79qv/t7iRrf/Wo+WCKPn1EURlEYRWEUhVEURlEYRWEURWSUu19l7n5EX3e/irveUNTr7sd8cEQeP6MojKIwisIoCqMojKIwisIoisgod7/K3P2IuqhlRf+n7/uoFEZRGEVhFIVRFEZRGEVhFIVRFEZRREa5+1HkR2Wsfkf4pFIYRWEUhVEURlEYRWEUhVEURlEYRTGFbC2dyE/KKIoHqpQhKupPm4EAAAAldEVYdGRhdGU6Y3JlYXRlADIwMjItMDktMTZUMDE6NDQ6MTMrMDA6MDCxXoB2AAAAJXRFWHRkYXRlOm1vZGlmeQAyMDIyLTA5LTE2VDAxOjQ0OjEzKzAwOjAwwAM4ygAAAD10RVh0aWNjOmNvcHlyaWdodABDb3B5cmlnaHQgMjAwNyBBcHBsZSBJbmMuLCBhbGwgcmlnaHRzIHJlc2VydmVkLp5m3CkAAAAjdEVYdGljYzpkZXNjcmlwdGlvbgBHZW5lcmljIFJHQiBQcm9maWxlGqc4jgAAAABJRU5ErkJggg=="></td>
      <td align="center">5000
(100.0%)</td>
      <td align="center">0
(0.0%)</td>
    </tr>
    <tr>
      <td align="center">5</td>
      <td align="left">voted2000
[numeric]</td>
      <td align="left" style="padding:8;vertical-align:middle"><table style="border-collapse:collapse;border:none;margin:0"><tbody><tr style="background-color:transparent"><td style="padding:0;margin:0;border:0" align="left">Min  : 0</td></tr><tr style="background-color:transparent"><td style="padding:0;margin:0;border:0" align="left">Mean : 0.3</td></tr><tr style="background-color:transparent"><td style="padding:0;margin:0;border:0" align="left">Max  : 1</td></tr></tbody></table></td>
      <td align="left" style="padding:0;vertical-align:middle"><table style="border-collapse:collapse;border:none;margin:0"><tbody><tr style="background-color:transparent"><td style="padding:0 2px 0 7px;margin:0;border:0" align="right">0</td><td style="padding:0 2px;border:0;" align="left">:</td><td style="padding:0 4px 0 6px;margin:0;border:0" align="right">3722</td><td style="padding:0;border:0" align="left">(</td><td style="padding:0 2px;margin:0;border:0" align="right">74.4%</td><td style="padding:0 4px 0 0;border:0" align="left">)</td></tr><tr style="background-color:transparent"><td style="padding:0 2px 0 7px;margin:0;border:0" align="right">1</td><td style="padding:0 2px;border:0;" align="left">:</td><td style="padding:0 4px 0 6px;margin:0;border:0" align="right">1278</td><td style="padding:0;border:0" align="left">(</td><td style="padding:0 2px;margin:0;border:0" align="right">25.6%</td><td style="padding:0 4px 0 0;border:0" align="left">)</td></tr></tbody></table></td>
      <td align="left" style="vertical-align:middle;padding:0;background-color:transparent;"><img style="border:none;background-color:transparent;padding:0;max-width:max-content;" src="data:image/png;base64, iVBORw0KGgoAAAANSUhEUgAAAHwAAAA3CAQAAABkiOaaAAAAAmJLR0QA/4ePzL8AAAAHdElNRQfmCRABLA0Xghr1AAAAnklEQVRo3u3ZsQ2AIBQAUb5xR3fQeXQHp9QWTWyIiHr3OhrDJR8LiC0xda03YLjhz+jzxfLzAz/GRXhKQ+u9VbQeVthRN5zGcBrDaQynMZzGcBrDaQynMZzmdOe2ln3lgyK/WI3iz3xD3ooddWz44YzPtz4oTK8+OdUeFN7+m8SOuuE0htMYTmM4jeE0htMYTmM4jeE0PijQYEfdcJodKzYLxwaTzoQAAAAldEVYdGRhdGU6Y3JlYXRlADIwMjItMDktMTZUMDE6NDQ6MTMrMDA6MDCxXoB2AAAAJXRFWHRkYXRlOm1vZGlmeQAyMDIyLTA5LTE2VDAxOjQ0OjEzKzAwOjAwwAM4ygAAAD10RVh0aWNjOmNvcHlyaWdodABDb3B5cmlnaHQgMjAwNyBBcHBsZSBJbmMuLCBhbGwgcmlnaHRzIHJlc2VydmVkLp5m3CkAAAAjdEVYdGljYzpkZXNjcmlwdGlvbgBHZW5lcmljIFJHQiBQcm9maWxlGqc4jgAAAABJRU5ErkJggg=="></td>
      <td align="center">5000
(100.0%)</td>
      <td align="center">0
(0.0%)</td>
    </tr>
    <tr>
      <td align="center">6</td>
      <td align="left">voted2002
[numeric]</td>
      <td align="left" style="padding:8;vertical-align:middle"><table style="border-collapse:collapse;border:none;margin:0"><tbody><tr style="background-color:transparent"><td style="padding:0;margin:0;border:0" align="left">Min  : 0</td></tr><tr style="background-color:transparent"><td style="padding:0;margin:0;border:0" align="left">Mean : 0.4</td></tr><tr style="background-color:transparent"><td style="padding:0;margin:0;border:0" align="left">Max  : 1</td></tr></tbody></table></td>
      <td align="left" style="padding:0;vertical-align:middle"><table style="border-collapse:collapse;border:none;margin:0"><tbody><tr style="background-color:transparent"><td style="padding:0 2px 0 7px;margin:0;border:0" align="right">0</td><td style="padding:0 2px;border:0;" align="left">:</td><td style="padding:0 4px 0 6px;margin:0;border:0" align="right">3058</td><td style="padding:0;border:0" align="left">(</td><td style="padding:0 2px;margin:0;border:0" align="right">61.2%</td><td style="padding:0 4px 0 0;border:0" align="left">)</td></tr><tr style="background-color:transparent"><td style="padding:0 2px 0 7px;margin:0;border:0" align="right">1</td><td style="padding:0 2px;border:0;" align="left">:</td><td style="padding:0 4px 0 6px;margin:0;border:0" align="right">1942</td><td style="padding:0;border:0" align="left">(</td><td style="padding:0 2px;margin:0;border:0" align="right">38.8%</td><td style="padding:0 4px 0 0;border:0" align="left">)</td></tr></tbody></table></td>
      <td align="left" style="vertical-align:middle;padding:0;background-color:transparent;"><img style="border:none;background-color:transparent;padding:0;max-width:max-content;" src="data:image/png;base64, iVBORw0KGgoAAAANSUhEUgAAAGgAAAA3CAQAAABKzccIAAAAAmJLR0QA/4ePzL8AAAAHdElNRQfmCRABLA0Xghr1AAAAn0lEQVRo3u3YsQmAMBBA0UTc0R10Ht3BKbWNgk0Q7nv+36WRPLhYXD1KroboCwj6G2hsD9tHH9RcH0ClTNF362i/nNKNnCB6gugJoieIniB6gugJoieIniB6t53C3vcVULVd9NTuz8TWGtKNXDrQ5Q2tIYvG5dVJD180vv0bSjdygugJoieIniB6gugJoieIniB6gujlXjRmKN3ICaJ3AppiC8fdrh9zAAAAJXRFWHRkYXRlOmNyZWF0ZQAyMDIyLTA5LTE2VDAxOjQ0OjEzKzAwOjAwsV6AdgAAACV0RVh0ZGF0ZTptb2RpZnkAMjAyMi0wOS0xNlQwMTo0NDoxMyswMDowMMADOMoAAAA9dEVYdGljYzpjb3B5cmlnaHQAQ29weXJpZ2h0IDIwMDcgQXBwbGUgSW5jLiwgYWxsIHJpZ2h0cyByZXNlcnZlZC6eZtwpAAAAI3RFWHRpY2M6ZGVzY3JpcHRpb24AR2VuZXJpYyBSR0IgUHJvZmlsZRqnOI4AAAAASUVORK5CYII="></td>
      <td align="center">5000
(100.0%)</td>
      <td align="center">0
(0.0%)</td>
    </tr>
    <tr>
      <td align="center">7</td>
      <td align="left">voted2004
[numeric]</td>
      <td align="left" style="padding:8;vertical-align:middle"><table style="border-collapse:collapse;border:none;margin:0"><tbody><tr style="background-color:transparent"><td style="padding:0;margin:0;border:0" align="left">Min  : 0</td></tr><tr style="background-color:transparent"><td style="padding:0;margin:0;border:0" align="left">Mean : 0.4</td></tr><tr style="background-color:transparent"><td style="padding:0;margin:0;border:0" align="left">Max  : 1</td></tr></tbody></table></td>
      <td align="left" style="padding:0;vertical-align:middle"><table style="border-collapse:collapse;border:none;margin:0"><tbody><tr style="background-color:transparent"><td style="padding:0 2px 0 7px;margin:0;border:0" align="right">0</td><td style="padding:0 2px;border:0;" align="left">:</td><td style="padding:0 4px 0 6px;margin:0;border:0" align="right">2941</td><td style="padding:0;border:0" align="left">(</td><td style="padding:0 2px;margin:0;border:0" align="right">58.8%</td><td style="padding:0 4px 0 0;border:0" align="left">)</td></tr><tr style="background-color:transparent"><td style="padding:0 2px 0 7px;margin:0;border:0" align="right">1</td><td style="padding:0 2px;border:0;" align="left">:</td><td style="padding:0 4px 0 6px;margin:0;border:0" align="right">2059</td><td style="padding:0;border:0" align="left">(</td><td style="padding:0 2px;margin:0;border:0" align="right">41.2%</td><td style="padding:0 4px 0 0;border:0" align="left">)</td></tr></tbody></table></td>
      <td align="left" style="vertical-align:middle;padding:0;background-color:transparent;"><img style="border:none;background-color:transparent;padding:0;max-width:max-content;" src="data:image/png;base64, iVBORw0KGgoAAAANSUhEUgAAAGUAAAA3CAQAAAC/M0y4AAAAAmJLR0QA/4ePzL8AAAAHdElNRQfmCRABLA0Xghr1AAAAoElEQVRo3u3YTQqAIBQAYY3u2B3qPHWHTllbDVr0A46P+XZuxIFnkPlIUQytD2BK7JSxXGzdXZw536SkNLU+2yN7tQo0YKYQmUJkCpEpRKYQmUJkCpEpRKYQXf7t93e7IOTykSW/3qaV8vSBBixQSnVX1oZPesvn6YY86f3xuQk0YKYQmUJkCpEpRKYQmUJkCpEpRKYQRX3S61ugATOF6ASrDwvHwXGkbQAAACV0RVh0ZGF0ZTpjcmVhdGUAMjAyMi0wOS0xNlQwMTo0NDoxMyswMDowMLFegHYAAAAldEVYdGRhdGU6bW9kaWZ5ADIwMjItMDktMTZUMDE6NDQ6MTMrMDA6MDDAAzjKAAAAPXRFWHRpY2M6Y29weXJpZ2h0AENvcHlyaWdodCAyMDA3IEFwcGxlIEluYy4sIGFsbCByaWdodHMgcmVzZXJ2ZWQunmbcKQAAACN0RVh0aWNjOmRlc2NyaXB0aW9uAEdlbmVyaWMgUkdCIFByb2ZpbGUapziOAAAAAElFTkSuQmCC"></td>
      <td align="center">5000
(100.0%)</td>
      <td align="center">0
(0.0%)</td>
    </tr>
    <tr>
      <td align="center">8</td>
      <td align="left">voted2006
[numeric]</td>
      <td align="left" style="padding:8;vertical-align:middle"><table style="border-collapse:collapse;border:none;margin:0"><tbody><tr style="background-color:transparent"><td style="padding:0;margin:0;border:0" align="left">Min  : 0</td></tr><tr style="background-color:transparent"><td style="padding:0;margin:0;border:0" align="left">Mean : 0.3</td></tr><tr style="background-color:transparent"><td style="padding:0;margin:0;border:0" align="left">Max  : 1</td></tr></tbody></table></td>
      <td align="left" style="padding:0;vertical-align:middle"><table style="border-collapse:collapse;border:none;margin:0"><tbody><tr style="background-color:transparent"><td style="padding:0 2px 0 7px;margin:0;border:0" align="right">0</td><td style="padding:0 2px;border:0;" align="left">:</td><td style="padding:0 4px 0 6px;margin:0;border:0" align="right">3373</td><td style="padding:0;border:0" align="left">(</td><td style="padding:0 2px;margin:0;border:0" align="right">67.5%</td><td style="padding:0 4px 0 0;border:0" align="left">)</td></tr><tr style="background-color:transparent"><td style="padding:0 2px 0 7px;margin:0;border:0" align="right">1</td><td style="padding:0 2px;border:0;" align="left">:</td><td style="padding:0 4px 0 6px;margin:0;border:0" align="right">1627</td><td style="padding:0;border:0" align="left">(</td><td style="padding:0 2px;margin:0;border:0" align="right">32.5%</td><td style="padding:0 4px 0 0;border:0" align="left">)</td></tr></tbody></table></td>
      <td align="left" style="vertical-align:middle;padding:0;background-color:transparent;"><img style="border:none;background-color:transparent;padding:0;max-width:max-content;" src="data:image/png;base64, iVBORw0KGgoAAAANSUhEUgAAAHIAAAA3CAQAAAB6QdYpAAAAAmJLR0QA/4ePzL8AAAAHdElNRQfmCRABLA0Xghr1AAAAoElEQVRo3u3YwQmAMBAAwUTs0R60Hu3BKvUbBUGCGtnb+eUjWbj4uLwlvq71BYw08r6+PCygBzrmi8iUhtZ3e8h6OIUYVyMpjKQwksJICiMpjKQwksJICiMpTjuete4rP5fLBV2u/sz/lF0hxjVE5OFNzq8vl6cmL+LT5XKr31qIcTWSwkgKIymMpDCSwkgKIymMpDCSIt5ymSrEuBpJsQNizAvH5o0cewAAACV0RVh0ZGF0ZTpjcmVhdGUAMjAyMi0wOS0xNlQwMTo0NDoxMyswMDowMLFegHYAAAAldEVYdGRhdGU6bW9kaWZ5ADIwMjItMDktMTZUMDE6NDQ6MTMrMDA6MDDAAzjKAAAAPXRFWHRpY2M6Y29weXJpZ2h0AENvcHlyaWdodCAyMDA3IEFwcGxlIEluYy4sIGFsbCByaWdodHMgcmVzZXJ2ZWQunmbcKQAAACN0RVh0aWNjOmRlc2NyaXB0aW9uAEdlbmVyaWMgUkdCIFByb2ZpbGUapziOAAAAAElFTkSuQmCC"></td>
      <td align="center">5000
(100.0%)</td>
      <td align="center">0
(0.0%)</td>
    </tr>
  </tbody>
</table>
<p>Generated by <a href="https://github.com/dcomtois/summarytools">summarytools</a> 1.0.1 (<a href="https://www.r-project.org/">R</a> version 4.2.1)<br>2022-09-16</p>
</div>
</div>
</div>
</section>
<section id="バランスチェック" class="level2">
<h2 class="anchored" data-anchor-id="バランスチェック">バランスチェック</h2>
<p>　バランスチェックの簡単な方法はグループごとに処置前変数（pre-treatment variables）の平均値を比較することである。無作為割当が成功しているのであれば、処置前に測定された変数の平均値は近似するはずである。ここではグループ（<code>treatment</code>）ごとに性別、誕生年、世帯規模、2000〜2004年の投票参加の平均値を比較してみる。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1"></a>df <span class="sc">|&gt;</span></span>
<span id="cb40-2"><a href="#cb40-2"></a>  <span class="fu">group_by</span>(treatment) <span class="sc">|&gt;</span></span>
<span id="cb40-3"><a href="#cb40-3"></a>  <span class="fu">summarise</span>(<span class="at">female    =</span> <span class="fu">mean</span>(female, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb40-4"><a href="#cb40-4"></a>            <span class="at">yob       =</span> <span class="fu">mean</span>(yob, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb40-5"><a href="#cb40-5"></a>            <span class="at">hh_size   =</span> <span class="fu">mean</span>(hh_size, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb40-6"><a href="#cb40-6"></a>            <span class="at">voted2000 =</span> <span class="fu">mean</span>(voted2000, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb40-7"><a href="#cb40-7"></a>            <span class="at">voted2002 =</span> <span class="fu">mean</span>(voted2002, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb40-8"><a href="#cb40-8"></a>            <span class="at">voted2004 =</span> <span class="fu">mean</span>(voted2004, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span></code><button title="コピーする" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 7
  treatment  female   yob hh_size voted2000 voted2002 voted2004
  &lt;chr&gt;       &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
1 Civic Duty  0.517 1957.    2.22     0.239     0.374     0.394
2 Control     0.491 1956.    2.17     0.261     0.390     0.411
3 Hawthorne   0.507 1956.    2.23     0.257     0.385     0.416
4 Neighbors   0.507 1955.    2.13     0.247     0.406     0.439
5 Self        0.526 1956.    2.19     0.253     0.383     0.401</code></pre>
</div>
</div>
<p>　それぞれの変数の平均値は非常に似ているため、無作為割当が成功したと考えられる。しかし、変数の単位によって判断が難しいかも知れない。たとえば、2つのグループがあり、年齢の平均値の差は3、世帯規模のそれは2だとする。これを見ると年齢の方がよりバランスが取れていないようにも見えるが、年齢の幅は数十であるに対し、世帯規模はせいぜい5〜6程度であろう。したがって、各変数のばらつきまで考慮した比較が適切であり、その方法の一つが標準化バイアス（=標準化差分）である。</p>
<p>　標準化差分を計算する便利パッケージ、{BalanceR}を使ってみよう。第1引数はデータだから、パイプで渡せば良い。<code>BalanceR()</code>内には<code>group</code>引数にグループ識別変数を、<code>cov</code>には処置前変数のベクトルを入れる。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1"></a>blc_chk <span class="ot">&lt;-</span> df <span class="sc">|&gt;</span></span>
<span id="cb42-2"><a href="#cb42-2"></a>  <span class="fu">BalanceR</span>(<span class="at">group =</span> treatment,</span>
<span id="cb42-3"><a href="#cb42-3"></a>           <span class="at">cov   =</span> <span class="fu">c</span>(female, yob, hh_size, voted2000, voted2002, voted2004))</span>
<span id="cb42-4"><a href="#cb42-4"></a></span>
<span id="cb42-5"><a href="#cb42-5"></a>blc_chk</span></code><button title="コピーする" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Covariate Mean:Civic Duty SD:Civic Duty Mean:Control SD:Control
1    female           0.517         0.500        0.491      0.500
2       yob        1957.304        14.515     1955.555     14.453
3   hh_size           2.225         0.810        2.169      0.777
4 voted2000           0.239         0.427        0.261      0.439
5 voted2002           0.374         0.484        0.390      0.488
6 voted2004           0.394         0.489        0.411      0.492
  Mean:Hawthorne SD:Hawthorne Mean:Neighbors SD:Neighbors Mean:Self SD:Self
1          0.507        0.500          0.507        0.500     0.526   0.500
2       1955.909       14.638       1954.976       14.510  1955.719  13.639
3          2.231        0.809          2.129        0.786     2.193   0.772
4          0.257        0.437          0.247        0.432     0.253   0.435
5          0.385        0.487          0.406        0.491     0.383   0.487
6          0.416        0.493          0.439        0.497     0.401   0.491
  SB:Civic Duty-Control SB:Civic Duty-Hawthorne SB:Civic Duty-Neighbors
1                 5.299                   2.062                   2.153
2                12.082                   9.573                  16.047
3                 7.102                  -0.723                  12.018
4                -5.157                  -4.225                  -1.860
5                -3.353                  -2.249                  -6.546
6                -3.420                  -4.405                  -9.094
  SB:Civic Duty-Self SB:Control-Hawthorne SB:Control-Neighbors SB:Control-Self
1             -1.746               -3.236               -3.145          -7.046
2             11.255               -2.437                3.997          -1.173
3              3.994               -7.847                5.060          -3.199
4             -3.260                0.931                3.296           1.896
5             -1.897                1.103               -3.191           1.456
6             -1.435               -0.985               -5.669           1.985
  SB:Hawthorne-Neighbors SB:Hawthorne-Self SB:Neighbors-Self
1                  0.090            -3.809            -3.899
2                  6.404             1.341            -5.281
3                 12.763             4.739            -8.258
4                  2.365             0.965            -1.400
5                 -4.295             0.353             4.648
6                 -4.684             2.970             7.656</code></pre>
</div>
</div>
<p>　ちなみに、<code>df</code>内に<code>female</code>から<code>voted2004</code>は連続している（<code>names(df)</code>で確認してみよう）。この場合は以下のように（<code>female:voted2004</code>）書き換えることもできる。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1"></a>blc_chk <span class="ot">&lt;-</span> df <span class="sc">|&gt;</span></span>
<span id="cb44-2"><a href="#cb44-2"></a>  <span class="fu">BalanceR</span>(<span class="at">group =</span> treatment,</span>
<span id="cb44-3"><a href="#cb44-3"></a>           <span class="at">cov   =</span> female<span class="sc">:</span>voted2004)</span>
<span id="cb44-4"><a href="#cb44-4"></a></span>
<span id="cb44-5"><a href="#cb44-5"></a>blc_chk</span></code><button title="コピーする" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>　標準化差分（標準化バイアス）を用いたバランスチェックはそれぞれのペアごとに計算を行うため、グループが多い場合は凡例が圧迫される場合が多い。しかし、重要なのは標準化差分の最大値だろう。ペア1、2、3でバランスが取れても、ペア4のバランスが取られていない場合は無意味だからだ。また、標準化差分の場合、符号の意味はなく、絶対値が重要だ。また、バランスチェックにおいてグループごとの平均値や標準偏差は不要である。ここで<code>summary()</code>関数を使うと、絶対値が最も大きい標準化差分のみ出力される。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1"></a><span class="fu">summary</span>(blc_chk)</span></code><button title="コピーする" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Covariate Abs_Maximum_SB
1    female          7.046
2       yob         16.047
3   hh_size         12.763
4 voted2000          5.157
5 voted2002          6.546
6 voted2004          9.094</code></pre>
</div>
</div>
<p>　<code>plot()</code>関数を使えば、これらの結果を可視化することもできる。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1"></a><span class="fu">plot</span>(blc_chk)</span></code><button title="コピーする" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-blc-1" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="day04_files/figure-html/fig-blc-1-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">図&nbsp;1: <strong>?(caption)</strong></figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>　先ほど述べたようにバランスチェックで重要なのは絶対値が最も大きい標準化差分である。<code>plot()</code>内に<code>simplify = TRUE</code>を指定すれば最大値のみ表示され、更に<code>abs = TRUE</code>にすると絶対値へ変換される。また、垂直のガイドラインは<code>vline</code>引数で変更できる。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1"></a><span class="co"># plot() の第1引数は blc_chk なのでパイプの使える</span></span>
<span id="cb48-2"><a href="#cb48-2"></a>blc_chk <span class="sc">|&gt;</span></span>
<span id="cb48-3"><a href="#cb48-3"></a>  <span class="fu">plot</span>(<span class="at">vline =</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">10</span>), <span class="at">simplify =</span> <span class="cn">TRUE</span>, <span class="at">abs =</span> <span class="cn">TRUE</span>)</span></code><button title="コピーする" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-blc-2" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="day04_files/figure-html/fig-blc-2-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">図&nbsp;2: <strong>?(caption)</strong></figcaption><p></p>
</figure>
</div>
</div>
</div>
</section>
<section id="処置効果の確認" class="level2">
<h2 class="anchored" data-anchor-id="処置効果の確認">処置効果の確認</h2>
<section id="グループごとの応答変数の平均値" class="level3">
<h3 class="anchored" data-anchor-id="グループごとの応答変数の平均値">グループごとの応答変数の平均値</h3>
<p>　処置効果を確認するためには各グループごとの応答変数（ここでは<code>voted2006</code>）の平均値を計算し、処置群の平均値から統制群の平均値を引く必要がある。まずは、特定の変数の平均値を計算する方法について紹介する。データ内にある特定の変数の平均値を計算するためには<code>summarise()</code>関数内に平均値を求める<code>mean()</code>関数を入れる。たとえば、<code>df</code>の<code>voted2006</code>の平均値を計算するコードは以下の通りである。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1"></a>df <span class="sc">|&gt;</span></span>
<span id="cb49-2"><a href="#cb49-2"></a>  <span class="fu">summarise</span>(<span class="fu">mean</span>(voted2006, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span></code><button title="コピーする" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 1
  `mean(voted2006, na.rm = TRUE)`
                            &lt;dbl&gt;
1                           0.325</code></pre>
</div>
</div>
<p>　<code>na.rm = TRUE</code>は「欠損値があれば、それを除外する」を意味し、指定されていない場合（=既定値）は<code>FALSE</code>になる。今回は欠損値がないものの、念の為に入れておく。</p>
<p>　出力結果を見ると、平均値が表示される列の名前が<code>`mean(voted2006, na.rm = TRUE)`</code>となっており、非常に見にくい。この場合、以下のように<code>mean()</code>の前に出力される列名を予め指定することもできる。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1"></a>df <span class="sc">|&gt;</span></span>
<span id="cb51-2"><a href="#cb51-2"></a>  <span class="co"># voted2006の平均値が表示される列名を Outcome にする。</span></span>
<span id="cb51-3"><a href="#cb51-3"></a>  <span class="fu">summarise</span>(<span class="at">Outcome =</span> <span class="fu">mean</span>(voted2006, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span></code><button title="コピーする" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 1
  Outcome
    &lt;dbl&gt;
1   0.325</code></pre>
</div>
</div>
<p>　我々が知りたいのは<code>voted2006</code>の平均値でなく、<strong>グループごと</strong>の平均値だろう。被験者がどのグループに属しているかわ示す変数は<code>treatment</code>であるが、<code>summarise()</code>にデータを渡す前に<code>group_by()</code>変数を使うと、グループごとに計算を行い、その結果を返す。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1"></a>df <span class="sc">|&gt;</span></span>
<span id="cb53-2"><a href="#cb53-2"></a>  <span class="fu">group_by</span>(treatment) <span class="sc">|&gt;</span></span>
<span id="cb53-3"><a href="#cb53-3"></a>  <span class="fu">summarise</span>(<span class="at">Outcome =</span> <span class="fu">mean</span>(voted2006, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span></code><button title="コピーする" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 2
  treatment  Outcome
  &lt;chr&gt;        &lt;dbl&gt;
1 Civic Duty   0.317
2 Control      0.299
3 Hawthorne    0.339
4 Neighbors    0.421
5 Self         0.364</code></pre>
</div>
</div>
<p>　<code>group_by()</code>内でも<code>=</code>演算子を使うと、グループ名が出力される列名を変更することができる。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1"></a>df <span class="sc">|&gt;</span></span>
<span id="cb55-2"><a href="#cb55-2"></a>  <span class="co"># グループ名が表示される列名を Group にする。</span></span>
<span id="cb55-3"><a href="#cb55-3"></a>  <span class="fu">group_by</span>(<span class="at">Groups =</span> treatment) <span class="sc">|&gt;</span></span>
<span id="cb55-4"><a href="#cb55-4"></a>  <span class="fu">summarise</span>(<span class="at">Outcome =</span> <span class="fu">mean</span>(voted2006, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span></code><button title="コピーする" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 2
  Groups     Outcome
  &lt;chr&gt;        &lt;dbl&gt;
1 Civic Duty   0.317
2 Control      0.299
3 Hawthorne    0.339
4 Neighbors    0.421
5 Self         0.364</code></pre>
</div>
</div>
<p>　ここで一つ注目したいのが、グループの表示順番である。変数のデータ型が文字型だと（Rコンソール上で<code>class(df$treatment)</code>を入力するか、<code>df</code>の出力画面で<code>treatment</code>の下に<code>&lt;chr&gt;</code>と表示されていることで確認できる）、今のようにアルファベット順で表示される。しかし、統制群は最初か最後に来るのが通例である。この順番をアルファベット順でなく、任意の順番にするためには<code>treatment</code>変数をfactor型変数へ変換する必要がある。Factor型は「順序付きの文字型変数」だと理解しても良い<a href="#fn5" class="footnote-ref" id="fnref5" role="doc-noteref"><sup>5</sup></a>。列の追加・上書き（今回は<code>treatment</code>列の上書き）の処理が必要なので<code>mutate()</code>関数を使う。変数をfactor型に変換する関数は<code>factor()</code>関数で、第1引数としてはfactor型へ変換する変数名を指定する。第2引数は<code>levels</code>であり、出力したい順番の文字型ベクトルを指定する。<strong>スペルミス</strong>に注意すること。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1"></a>df <span class="sc">|&gt;</span></span>
<span id="cb57-2"><a href="#cb57-2"></a>  <span class="fu">mutate</span>(<span class="at">treatment =</span> <span class="fu">factor</span>(treatment,</span>
<span id="cb57-3"><a href="#cb57-3"></a>                            <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Control"</span>, <span class="st">"Civic Duty"</span>,</span>
<span id="cb57-4"><a href="#cb57-4"></a>                                       <span class="st">"Self"</span>, <span class="st">"Neighbors"</span>, <span class="st">"Hawthorne"</span>)))</span></code><button title="コピーする" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5,000 × 13
   treatm…¹ female   yob hh_size voted…² voted…³ voted…⁴ voted…⁵ treat…⁶ treat…⁷
   &lt;fct&gt;     &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;int&gt;   &lt;int&gt;
 1 Hawthor…      1  1955       1       0       1       0       0       0       0
 2 Hawthor…      0  1969       2       0       1       0       0       0       0
 3 Control       1  1944       2       0       0       0       0       0       1
 4 Control       0  1974       2       0       0       1       0       0       1
 5 Neighbo…      1  1969       2       0       0       1       0       0       0
 6 Control       0  1942       1       0       1       0       0       0       1
 7 Civic D…      0  1969       2       1       0       0       0       1       0
 8 Hawthor…      0  1966       2       0       1       0       1       0       0
 9 Control       0  1949       2       0       1       1       0       0       1
10 Control       1  1958       2       0       1       0       0       0       1
# … with 4,990 more rows, 3 more variables: treatment_Hawthorne &lt;int&gt;,
#   treatment_Neighbors &lt;int&gt;, treatment_Self &lt;int&gt;, and abbreviated variable
#   names ¹​treatment, ²​voted2000, ³​voted2002, ⁴​voted2004, ⁵​voted2006,
#   ⁶​`treatment_Civic Duty`, ⁷​treatment_Control</code></pre>
</div>
</div>
<p>　<code>treatment</code>列名の下が<code>&lt;fct&gt;</code>となっていることが分かる。これは<code>treatment</code>列のデータ型がfactor型であることを意味する。問題なく動くことが確認できたので、<code>df</code>を上書きしよう。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1"></a>df <span class="ot">&lt;-</span> df <span class="sc">|&gt;</span></span>
<span id="cb59-2"><a href="#cb59-2"></a>  <span class="fu">mutate</span>(<span class="at">treatment =</span> <span class="fu">factor</span>(treatment,</span>
<span id="cb59-3"><a href="#cb59-3"></a>                            <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Control"</span>, <span class="st">"Civic Duty"</span>,</span>
<span id="cb59-4"><a href="#cb59-4"></a>                                       <span class="st">"Self"</span>, <span class="st">"Neighbors"</span>, <span class="st">"Hawthorne"</span>)))</span></code><button title="コピーする" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>　それでは、改めてグループごとの<code>voted2006</code>の平均値を計算してみよう。今回は計算結果を<code>out_mean_df</code>という名のオブジェクトとして格納する。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1"></a>out_mean_df <span class="ot">&lt;-</span> df <span class="sc">|&gt;</span></span>
<span id="cb60-2"><a href="#cb60-2"></a>  <span class="fu">group_by</span>(<span class="at">Groups =</span> treatment) <span class="sc">|&gt;</span></span>
<span id="cb60-3"><a href="#cb60-3"></a>  <span class="fu">summarise</span>(<span class="at">Outcome =</span> <span class="fu">mean</span>(voted2006, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb60-4"><a href="#cb60-4"></a></span>
<span id="cb60-5"><a href="#cb60-5"></a>out_mean_df</span></code><button title="コピーする" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 2
  Groups     Outcome
  &lt;fct&gt;        &lt;dbl&gt;
1 Control      0.299
2 Civic Duty   0.317
3 Self         0.364
4 Neighbors    0.421
5 Hawthorne    0.339</code></pre>
</div>
</div>
<p>　今回は統制群は最初に出力されていることが確認できる。</p>
<p>　それではこの結果をグラフとして示してみよう。作図には{ggplot2}パッケージを使う。まずは<code>out_mean_df</code>を<code>ggplot()</code>関数に渡す。<code>ggplot()</code>関数以降は、<code>+</code>演算子を使ってレイヤーを足していくこととなる。棒グラフのレイヤーは<code>geom_bar()</code>関数であり、その中に<code>aes()</code>関数を入れる。<code>aes()</code>の中には棒グラフの作図に必要な情報を入れる必要がある（これを<strong>マッピング</strong>（mapping）と呼ぶ）。棒グラフを作成するために必要な最低限の情報とは各棒の横軸上の位置（<code>x</code>）と棒の高さ（<code>y</code>）だ。今回は横軸がグループ名、縦軸が平均値となる棒グラフを作る。<code>aes()</code>外側には<code>stat = "identity"</code>を忘れずに付けること。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1"></a>out_mean_df <span class="sc">|&gt;</span></span>
<span id="cb62-2"><a href="#cb62-2"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb62-3"><a href="#cb62-3"></a>  <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">x =</span> Groups, <span class="at">y =</span> Outcome), <span class="at">stat =</span> <span class="st">"identity"</span>)</span></code><button title="コピーする" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-intro-bar-1" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="day04_files/figure-html/fig-intro-bar-1-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">図&nbsp;3: <strong>?(caption)</strong></figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>　続いて、このグラフの見た目を調整してみよう。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1"></a>out_mean_df <span class="sc">|&gt;</span></span>
<span id="cb63-2"><a href="#cb63-2"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb63-3"><a href="#cb63-3"></a>  <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">x =</span> Groups, <span class="at">y =</span> Outcome), <span class="at">stat =</span> <span class="st">"identity"</span>) <span class="sc">+</span></span>
<span id="cb63-4"><a href="#cb63-4"></a>  <span class="co"># 縦軸（y軸）のラベルを変更する</span></span>
<span id="cb63-5"><a href="#cb63-5"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Mean(Outcome)"</span>) <span class="sc">+</span></span>
<span id="cb63-6"><a href="#cb63-6"></a>  <span class="co"># grayテーマ（デフォルトのテーマ）を使用し、フォントサイズは14</span></span>
<span id="cb63-7"><a href="#cb63-7"></a>  <span class="fu">theme_gray</span>(<span class="at">base_size =</span> <span class="dv">14</span>)</span></code><button title="コピーする" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-intro-bar-2" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="day04_files/figure-html/fig-intro-bar-2-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">図&nbsp;4: <strong>?(caption)</strong></figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>　また、<code>geom_label()</code>レイヤーを足すと、棒の上にラベルを付けることもできる。ラベルに必要な情報は各ラベルの横軸上の位置（<code>x</code>）、縦軸上の位置（<code>y</code>）、ラベルの表示内容（<code>label</code>）だ。今回のラベルは平均値の具体的な数値を入れてみよう。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1"></a>out_mean_df <span class="sc">|&gt;</span></span>
<span id="cb64-2"><a href="#cb64-2"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb64-3"><a href="#cb64-3"></a>  <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">x =</span> Groups, <span class="at">y =</span> Outcome), <span class="at">stat =</span> <span class="st">"identity"</span>) <span class="sc">+</span></span>
<span id="cb64-4"><a href="#cb64-4"></a>  <span class="fu">geom_label</span>(<span class="fu">aes</span>(<span class="at">x =</span> Groups, <span class="at">y =</span> Outcome, <span class="at">label =</span> Outcome)) <span class="sc">+</span></span>
<span id="cb64-5"><a href="#cb64-5"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Mean(Outcome)"</span>) <span class="sc">+</span></span>
<span id="cb64-6"><a href="#cb64-6"></a>  <span class="fu">theme_gray</span>(<span class="at">base_size =</span> <span class="dv">14</span>)</span></code><button title="コピーする" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-intro-bar-3" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="day04_files/figure-html/fig-intro-bar-3-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">図&nbsp;5: <strong>?(caption)</strong></figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>　小数点が長すぎるので3桁まで表示としよう。ここでは<code>sprintf()</code>を使用する。使い方が簡単とは言えないが、覚える必要はなく、必要な時にググるか、本資料のコードをコピペすれば良い<a href="#fn6" class="footnote-ref" id="fnref6" role="doc-noteref"><sup>6</sup></a>。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1"></a>out_mean_df <span class="sc">|&gt;</span></span>
<span id="cb65-2"><a href="#cb65-2"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb65-3"><a href="#cb65-3"></a>  <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">x =</span> Groups, <span class="at">y =</span> Outcome), <span class="at">stat =</span> <span class="st">"identity"</span>) <span class="sc">+</span></span>
<span id="cb65-4"><a href="#cb65-4"></a>  <span class="co"># 2桁までなら %.3f を %.2f に変更</span></span>
<span id="cb65-5"><a href="#cb65-5"></a>  <span class="fu">geom_label</span>(<span class="fu">aes</span>(<span class="at">x =</span> Groups, <span class="at">y =</span> Outcome, <span class="at">label =</span> <span class="fu">sprintf</span>(<span class="st">"%.3f"</span>, Outcome))) <span class="sc">+</span></span>
<span id="cb65-6"><a href="#cb65-6"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Mean(Outcome)"</span>) <span class="sc">+</span></span>
<span id="cb65-7"><a href="#cb65-7"></a>  <span class="fu">theme_gray</span>(<span class="at">base_size =</span> <span class="dv">14</span>)</span></code><button title="コピーする" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-intro-bar-4" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="day04_files/figure-html/fig-intro-bar-4-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">図&nbsp;6: <strong>?(caption)</strong></figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>　これで可視化ができた。ただし、以上のコードには改善の余地がある。<code>geom_bar()</code>と<code>geom_label()</code>内の<code>aes()</code>関数に注目して欲しい。よく見ると<code>x</code>と<code>y</code>と同じだろう。<code>geom_*()</code>が共有するマッピングがあれば、<code>ggplot()</code>内で指定することでコードを効率化することもできる。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1"></a>out_mean_df <span class="sc">|&gt;</span></span>
<span id="cb66-2"><a href="#cb66-2"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Groups, <span class="at">y =</span> Outcome)) <span class="sc">+</span></span>
<span id="cb66-3"><a href="#cb66-3"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>) <span class="sc">+</span></span>
<span id="cb66-4"><a href="#cb66-4"></a>  <span class="fu">geom_label</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">sprintf</span>(<span class="st">"%.3f"</span>, Outcome))) <span class="sc">+</span></span>
<span id="cb66-5"><a href="#cb66-5"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Mean(Outcome)"</span>) <span class="sc">+</span></span>
<span id="cb66-6"><a href="#cb66-6"></a>  <span class="fu">theme_gray</span>(<span class="at">base_size =</span> <span class="dv">14</span>)</span></code><button title="コピーする" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-intro-bar-5" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="day04_files/figure-html/fig-intro-bar-5-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">図&nbsp;7: <strong>?(caption)</strong></figcaption><p></p>
</figure>
</div>
</div>
</div>
</section>
<section id="統計的推定単回帰分析" class="level3">
<h3 class="anchored" data-anchor-id="統計的推定単回帰分析">統計的推定（単回帰分析）</h3>
<p>　これまでの作業はグループごとの応答変数の平均値であって、処置効果ではない。処置効果を計算するためには処置群の平均値から統制群の平均値を引く必要がある。たとえば、Civic Dutyはがき群の平均値は約0.317、統制群のそれは0.299であるため、Civic Dutyはがきの処置効果は約0.018である。しかし、これを各グループごとに計算することは面倒だし、何よりも得られた値が<strong>点推定値</strong>だという限界がある。得られた処置効果の不確実性は計算できない。</p>
<p>　ここで有効なのが線形回帰分析である。回帰分析を行うことで処置効果の点推定値のみならず、不確実性の指標である標準誤差も計算され、区間推定や統計的仮説検定も可能となる。線形回帰分析の関数は<code>lm()</code>だ。第1引数としては回帰式であり、<code>応答変数 ~ 説明変数</code>と表記する。第2引数は<code>data</code>であり、回帰式で指定した変数が入っているデータ名を指定する。回帰分析の結果は名前を付けてオブジェクトとして格納し、<code>summary()</code>関数を使うと、詳細が確認できる。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1"></a>fit1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(voted2006 <span class="sc">~</span> treatment, <span class="at">data =</span> df)</span>
<span id="cb67-2"><a href="#cb67-2"></a></span>
<span id="cb67-3"><a href="#cb67-3"></a><span class="fu">summary</span>(fit1)</span></code><button title="コピーする" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = voted2006 ~ treatment, data = df)

Residuals:
    Min      1Q  Median      3Q     Max 
-0.4206 -0.3166 -0.2985  0.6357  0.7015 

Coefficients:
                    Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)         0.298524   0.008864  33.680  &lt; 2e-16 ***
treatmentCivic Duty 0.018085   0.021355   0.847   0.3971    
treatmentSelf       0.065789   0.022002   2.990   0.0028 ** 
treatmentNeighbors  0.122037   0.022053   5.534  3.3e-08 ***
treatmentHawthorne  0.040637   0.021447   1.895   0.0582 .  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.4671 on 4995 degrees of freedom
Multiple R-squared:  0.007123,  Adjusted R-squared:  0.006328 
F-statistic: 8.959 on 4 and 4995 DF,  p-value: 3.312e-07</code></pre>
</div>
</div>
<p>　ちなみに、これもパイプ演算子を使うことができる。ただし、第1引数として渡すパイプ演算子の特徴上、そのまま使うことはできない。なぜなら<code>lm()</code>関数の第1引数はデータでなく、回帰式（formula型）だから。この場合はプレースホルダー（place holder）を指定する必要がある。パイプ前のオブジェクトが入る位置を任意に指定することであり、<code>_</code>を使う。<code>%&gt;%</code>演算子を使う場合は<code>_</code>でなく、<code>.</code>を使う。上記のコードと以下のコードは同じコードとなる。プレースホルダーは自分が使うパイプ演算子によって使い分けること。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1"></a>fit1 <span class="ot">&lt;-</span> df <span class="sc">|&gt;</span> <span class="co"># |&gt; パイプを使う場合</span></span>
<span id="cb69-2"><a href="#cb69-2"></a>  <span class="fu">lm</span>(voted2006 <span class="sc">~</span> treatment, <span class="at">data =</span> _)</span>
<span id="cb69-3"><a href="#cb69-3"></a></span>
<span id="cb69-4"><a href="#cb69-4"></a>fit1 <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> <span class="co"># %&gt;% パイプを使う場合</span></span>
<span id="cb69-5"><a href="#cb69-5"></a>  <span class="fu">lm</span>(voted2006 <span class="sc">~</span> treatment, <span class="at">data =</span> .)</span></code><button title="コピーする" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>　Factor型、または文字型変数が説明変数の場合、自動的にダミー変数として処理され、Factor型の場合、最初の水準（ここでは<code>"Control"</code>）がベースカテゴリとなる。説明変数が文字型ならアルファベット順で最初の水準がベースカテゴリとなり、今回の例だと<code>"Civic Duty"</code>がベースカテゴリとなる。処置効果は「統制群に比べて〜」が重要となるので、数値型以外の説明変数は予めfactor化しておいた方が望ましい。</p>
<p>　Civic Dutyの推定値は約0.018であり、これは統制群に比べ、Civic Duty群の<code>voted2006</code>の平均値は約0.018高いことを意味する。応答変数が0、1であるため、これを割合（=投票率）で換算すると、約1.8%p高いことを意味する。つまり、Civic Dutyのはがきをもらった被験者はそうでない被験者に比べて投票率が約1.8%p高いことを意味する。他の推定値も同じやり方で解釈すれば良い。</p>
<p>　それではこれらの処置効果が<strong>統計的に有意</strong>なものかを確認してみよう。統計的有意か否かを判定するためには有意と非有意の境界線が必要である、これは通常、<strong>有意水準</strong>（significance level; <span class="math inline">\(\alpha\)</span>）と呼ばれる。この有意水準は分析者が決めるものであるが、社会科学で広く使われる基準は<span class="math inline">\(\alpha = 0.05\)</span>、つまり5%だ。分析結果の画面には<code>Pr(&gt;|t|)</code>列が表示されているが、これが<span class="math inline">\(p\)</span>値と呼ばれるもので、これが0.05を下回る場合、統計的に有意と判定する。もし、<span class="math inline">\(\alpha = 0.1\)</span>を採用するなら、<span class="math inline">\(p &lt; 0.1\)</span>の場合において統計的に有意と判定する。Civic Dutyの<span class="math inline">\(p\)</span>値は3.3e-08であり、これは<span class="math inline">\(3.3 \times 10^{-8}\)</span>を意味する。<span class="math inline">\(10^{-1}\)</span>は0.1、<span class="math inline">\(10^{-2}\)</span>は0.01であることを考えると非常に小さい数値であり、統計的に有意であると考えられる。また、<span class="math inline">\(p\)</span>値が一定値以下であれば<code>&lt; 2e-16</code>と表示される。今回の結果は、2つの処置群（SelfとNeighbors）において処置効果は統計的に有意であると判定できよう。</p>
<p>　今回はサンプルサイズ34万から無作為抽出した<span class="math inline">\(n\)</span>=5000のデータを使ったが、実際の論文ではいずれも統計的に有意である。なぜなら統計的有意性を判定する<span class="math inline">\(p\)</span>値は処置効果の大きさ以外にも、推定値のばらつき具合（=標準誤差）の影響を受けるが、この標準誤差はサンプルサイズに反比例するからだ。ここで重要なことが分かる。それは「統計的に非有意な処置効果」は「処置効果がない」ことを意味しないことだ。たとえば、我々が日本人から男女3名ずつ抽出し、平均身長が同じだとしよう。ここから「母集団において男女の身長差はない」と解釈できるだろうか。それは全く誤りであろう。統計的に非有意な結果から分かるのは「現在のサンプル/手法/モデルにおいて男女間に身長差があるとは言えない」程度である。もう一回、男女3人ずつ抽出して比較してみれば差はあるかも知れない。また、今回はたまたま平均身長が同じだけであって、サンプルサイズが大きければ統計的に有意な差は得られるかも知れない。</p>
<p>　一方、統計的に有意な差が得られたのであれば、「母集団において男女の身長差がある」と解釈できるようになる。これはもう一回、男女3人ずつ無作為抽出しても差が確認されることを意味する。むろん、100%ではない。もう一回やってみたところ、差がない可能性もある。ただし、その可能性は非常に小さく、その可能性が小さいことを、統計学では<span class="math inline">\(p\)</span>値が小さいと言う。<span class="math inline">\(p\)</span>値の厳密な意味は「帰無仮説が正しいと仮定した場合、今回得られた統計量と同じか、より極端な結果が得られる確率」である。身長差の例だと、帰無仮説は「男女間に身長差はない」であり、統計量とは<span class="math inline">\(t\)</span>検定や単回帰分析の場合、「<span class="math inline">\(t\)</span>統計量」を意味する。詳細は<a href="https://www.jaysong.net/notes/stats/asa_p_value.html">p値に関するアメリカ統計学会の声明</a>や、<a href="http://tintstyle.cafe24.com/Data/Research/Conference/JAES2019.pdf">矢内・SONG (2019)</a>を参照すること。</p>
<p>　話がややずれたが、Rの実習に戻そう。続いて、この結果を可視化してみよう。ここでも{ggplot2}パッケージを使って可視化をするが、{ggplot2}で使用可能なオブジェクトは表形式のデータである。Rコンソール上で<code>class(オブジェクト名)</code>を入力すると、データのクラスが出力されるが、このクラスに<code>"data.frame"</code>があれば、{ggplot2}で使用できる。たとえば、<code>fit1</code>オブジェクトのクラスは<code>"lm"</code>であるため、そのまま{ggplot2}で使うことはできない。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1"></a><span class="fu">class</span>(fit1)</span></code><button title="コピーする" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "lm"</code></pre>
</div>
</div>
<p>　推定結果を表形式に変換するためには{broom}パッケージの<code>tidy()</code>関数が便利だ。使い方は簡単で<code>tidy()</code>内に回帰分析の推定結果が格納されたオブジェクトを入れるだけである。ただし、デフォルトの設定では95%信頼区間が表示されないため、中には<code>conf.int = TRUE</code>を追加しておく必要がある。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1"></a><span class="co"># 90%信頼区間を使うのであれば conf.int = 0.9 を追加（デフォルトは0.95）</span></span>
<span id="cb72-2"><a href="#cb72-2"></a>fit1_coef <span class="ot">&lt;-</span> <span class="fu">tidy</span>(fit1, <span class="at">conf.int =</span> <span class="cn">TRUE</span>)</span>
<span id="cb72-3"><a href="#cb72-3"></a></span>
<span id="cb72-4"><a href="#cb72-4"></a>fit1_coef</span></code><button title="コピーする" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 7
  term                estimate std.error statistic   p.value conf.low conf.high
  &lt;chr&gt;                  &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
1 (Intercept)           0.299    0.00886    33.7   2.80e-224  0.281      0.316 
2 treatmentCivic Duty   0.0181   0.0214      0.847 3.97e-  1 -0.0238     0.0599
3 treatmentSelf         0.0658   0.0220      2.99  2.80e-  3  0.0227     0.109 
4 treatmentNeighbors    0.122    0.0221      5.53  3.30e-  8  0.0788     0.165 
5 treatmentHawthorne    0.0406   0.0214      1.89  5.82e-  2 -0.00141    0.0827</code></pre>
</div>
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1"></a><span class="fu">class</span>(fit1_coef)</span></code><button title="コピーする" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "tbl_df"     "tbl"        "data.frame"</code></pre>
</div>
</div>
<p>　<code>fit1_coef</code>のクラスに<code>"data.frame"</code>が含まれているので、これを使って作図することができる。</p>
<p>　作図する前に、<code>fit1_coef</code>の加工しておきたい。それぞれの係数（<code>estimate</code>列）は処置効果を表しているが、切片（<code>"(Intercept)"</code>）の推定値は処置効果とは無関係である。したがって、予め切片の行を除外しておきたい。特定の行を残したり、除外する関数は<code>filter()</code>である。今回は<code>term</code>列の値が<code>"(Intercept)"</code><strong>ではない</strong>行を残したいので、同値演算子（<code>==</code>）の否定を意味する<code>!=</code>演算子を使用する。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1"></a>fit1_coef <span class="ot">&lt;-</span> fit1_coef <span class="sc">|&gt;</span></span>
<span id="cb76-2"><a href="#cb76-2"></a>  <span class="fu">filter</span>(term <span class="sc">!=</span> <span class="st">"(Intercept)"</span>)</span>
<span id="cb76-3"><a href="#cb76-3"></a></span>
<span id="cb76-4"><a href="#cb76-4"></a>fit1_coef</span></code><button title="コピーする" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 7
  term                estimate std.error statistic      p.value conf.low conf.…¹
  &lt;chr&gt;                  &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;        &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;
1 treatmentCivic Duty   0.0181    0.0214     0.847 0.397        -0.0238   0.0599
2 treatmentSelf         0.0658    0.0220     2.99  0.00280       0.0227   0.109 
3 treatmentNeighbors    0.122     0.0221     5.53  0.0000000330  0.0788   0.165 
4 treatmentHawthorne    0.0406    0.0214     1.89  0.0582       -0.00141  0.0827
# … with abbreviated variable name ¹​conf.high</code></pre>
</div>
</div>
<p>　それでは作図に入ろう。処置効果を示す場合は、点推定値以外にもその不確実性を示すのは一般的である。不確実性の指標として幅広く使われるのは標準誤差（standard error; 標準<strong>偏差</strong>ではない）であるが、可視化の際にはこの標準誤差に基づき計算した信頼区間を示すのが一般的だ。有意水準が5%であれば、95%信頼区間を示し、10%なら90%信頼区間を用いる。</p>
<p>　点と区間を同時に示すプロットがpoint-rangeプロットであり、{ggplot2}では<code>geom_pointrange()</code>レイヤーを使う。必要な情報はpoint-rangeの横軸上の位置（<code>x</code>）、点の縦軸上の位置（<code>y</code>）、区間の上限（<code>ymax</code>）と下限（<code>ymin</code>）である。これらの情報は全て<code>fit1_coef</code>に入っているため、<code>fit1_coef</code>をそのまま<code>ggplot()</code>関数に渡して作図することができる。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1"></a>fit1_coef <span class="sc">|&gt;</span></span>
<span id="cb78-2"><a href="#cb78-2"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb78-3"><a href="#cb78-3"></a>  <span class="fu">geom_pointrange</span>(<span class="fu">aes</span>(<span class="at">x =</span> term, <span class="at">y =</span> estimate,</span>
<span id="cb78-4"><a href="#cb78-4"></a>                      <span class="at">ymin =</span> conf.low, <span class="at">ymax =</span> conf.high))</span></code><button title="コピーする" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-intro-pointrange-1" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="day04_files/figure-html/fig-intro-pointrange-1-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">図&nbsp;8: <strong>?(caption)</strong></figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>　それでは図をカスタマイズしてみよう。図内の様々なラベルを修正する<code>labs()</code>レイヤーでラベルを修正する。テーマはデフォルトの<code>theme_gray()</code>の代わりに白黒テーマ（<code>theme_bw()</code>）を使用し、フォントサイズは12とする。また、y = 0の水平線を追加する。95%信頼区間内に0が含まれる場合、「5%水準で統計的に有意でない」と判断できる。水平線を描くには<code>geom_hline()</code>レイヤーを追加し、<code>yintercept = 0</code>を指定することで、0のところに水平線が描ける。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1"></a>fit1_coef <span class="sc">|&gt;</span></span>
<span id="cb79-2"><a href="#cb79-2"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb79-3"><a href="#cb79-3"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb79-4"><a href="#cb79-4"></a>  <span class="fu">geom_pointrange</span>(<span class="fu">aes</span>(<span class="at">x =</span> term, <span class="at">y =</span> estimate,</span>
<span id="cb79-5"><a href="#cb79-5"></a>                      <span class="at">ymin =</span> conf.low, <span class="at">ymax =</span> conf.high)) <span class="sc">+</span></span>
<span id="cb79-6"><a href="#cb79-6"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Treatments"</span>, <span class="at">y =</span> <span class="st">"Average Treatment Effects"</span>) <span class="sc">+</span></span>
<span id="cb79-7"><a href="#cb79-7"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">12</span>)</span></code><button title="コピーする" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-intro-pointrange-2" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="day04_files/figure-html/fig-intro-pointrange-2-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">図&nbsp;9: <strong>?(caption)</strong></figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>　まだ気になる点がある。それは横軸の目盛りラベルに<code>treatment</code>という不要な情報がある点だ。これは作図の時点で修正することも可能だが、まずは<code>df</code>の<code>term</code>変数の値を修正する方法を紹介する。変数の値を修正する時には<code>recode()</code>関数を使用する。第1引数はリコーディングする変数名であり、引き続き<code>"元の値" = "新しい値"</code>を指定すれば良い。<strong>スペルミスに注意</strong>すること。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1"></a>fit1_coef <span class="ot">&lt;-</span> fit1_coef <span class="sc">|&gt;</span></span>
<span id="cb80-2"><a href="#cb80-2"></a>  <span class="fu">mutate</span>(<span class="at">term =</span> <span class="fu">recode</span>(term,</span>
<span id="cb80-3"><a href="#cb80-3"></a>                       <span class="st">"treatmentCivic Duty"</span> <span class="ot">=</span> <span class="st">"Civic Duty"</span>,</span>
<span id="cb80-4"><a href="#cb80-4"></a>                       <span class="st">"treatmentHawthorne"</span>  <span class="ot">=</span> <span class="st">"Hawthorne"</span>,</span>
<span id="cb80-5"><a href="#cb80-5"></a>                       <span class="st">"treatmentNeighbors"</span>  <span class="ot">=</span> <span class="st">"Neighbors"</span>,</span>
<span id="cb80-6"><a href="#cb80-6"></a>                       <span class="st">"treatmentSelf"</span>       <span class="ot">=</span> <span class="st">"Self"</span>))</span>
<span id="cb80-7"><a href="#cb80-7"></a></span>
<span id="cb80-8"><a href="#cb80-8"></a>fit1_coef</span></code><button title="コピーする" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 7
  term       estimate std.error statistic      p.value conf.low conf.high
  &lt;chr&gt;         &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;        &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
1 Civic Duty   0.0181    0.0214     0.847 0.397        -0.0238     0.0599
2 Self         0.0658    0.0220     2.99  0.00280       0.0227     0.109 
3 Neighbors    0.122     0.0221     5.53  0.0000000330  0.0788     0.165 
4 Hawthorne    0.0406    0.0214     1.89  0.0582       -0.00141    0.0827</code></pre>
</div>
</div>
<p>　以上の作業は<code>term</code>列の各値から<code>"treatment"</code>文字を<code>""</code>に置換することなので、文字列を置換する関数である<code>str_replace()</code>を使えば、より短くすることができる。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1"></a>fit1_coef <span class="ot">&lt;-</span> fit1_coef <span class="sc">|&gt;</span></span>
<span id="cb82-2"><a href="#cb82-2"></a>  <span class="fu">mutate</span>(<span class="at">term =</span> <span class="fu">str_replace</span>(term, <span class="st">"treatment"</span>, <span class="st">""</span>))</span></code><button title="コピーする" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>　<code>fit1_coef</code>も修正できたので、 <a href="#fig-intro-pointrange-2">図&nbsp;9</a> と同じコードでもう一度作図してみよう。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1"></a>fit1_coef <span class="sc">|&gt;</span></span>
<span id="cb83-2"><a href="#cb83-2"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb83-3"><a href="#cb83-3"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb83-4"><a href="#cb83-4"></a>  <span class="fu">geom_pointrange</span>(<span class="fu">aes</span>(<span class="at">x =</span> term, <span class="at">y =</span> estimate,</span>
<span id="cb83-5"><a href="#cb83-5"></a>                      <span class="at">ymin =</span> conf.low, <span class="at">ymax =</span> conf.high)) <span class="sc">+</span></span>
<span id="cb83-6"><a href="#cb83-6"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Treatments"</span>, <span class="at">y =</span> <span class="st">"Average Treatment Effects"</span>) <span class="sc">+</span></span>
<span id="cb83-7"><a href="#cb83-7"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">12</span>)</span></code><button title="コピーする" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-intro-pointrange-3" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="day04_files/figure-html/fig-intro-pointrange-3-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">図&nbsp;10: <strong>?(caption)</strong></figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>　最後に横軸の順番を修正してみよう。<code>fit1_coef</code>の<code>term</code>列は文字型変数であるため、アルファベット順になる。これを<code>df</code>の<code>treatment</code>列と同様、Civic Duty、Self、Neighbors、Hawthorneの順にしたい。この場合<code>fit1_coef</code>の<code>term</code>列をfactor化すれば良い。<code>factor()</code>関数を使っても良いが、ここではまた便利な技を紹介しよう。それは<code>fct_inorder()</code>関数だ。これは表示されている順番をfactorの順番とする関数だ。実際、<code>fit1_coef</code>の中身を見ると、表示順番はCivic Duty、Self、Neighbors、Hawthorneだ。非常に嬉しい状況なので、<code>fct_inorder()</code>を使ってみよう。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1"></a>fit1_coef <span class="ot">&lt;-</span> fit1_coef <span class="sc">|&gt;</span></span>
<span id="cb84-2"><a href="#cb84-2"></a>  <span class="fu">mutate</span>(<span class="at">term =</span> <span class="fu">fct_inorder</span>(term))</span>
<span id="cb84-3"><a href="#cb84-3"></a></span>
<span id="cb84-4"><a href="#cb84-4"></a>fit1_coef</span></code><button title="コピーする" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 7
  term       estimate std.error statistic      p.value conf.low conf.high
  &lt;fct&gt;         &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;        &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
1 Civic Duty   0.0181    0.0214     0.847 0.397        -0.0238     0.0599
2 Self         0.0658    0.0220     2.99  0.00280       0.0227     0.109 
3 Neighbors    0.122     0.0221     5.53  0.0000000330  0.0788     0.165 
4 Hawthorne    0.0406    0.0214     1.89  0.0582       -0.00141    0.0827</code></pre>
</div>
</div>
<p>　それでは、 <a href="#fig-intro-pointrange-3">図&nbsp;10</a> と同じコードでもう一度作図してみよう。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1"></a>fit1_coef <span class="sc">|&gt;</span></span>
<span id="cb86-2"><a href="#cb86-2"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb86-3"><a href="#cb86-3"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb86-4"><a href="#cb86-4"></a>  <span class="fu">geom_pointrange</span>(<span class="fu">aes</span>(<span class="at">x =</span> term, <span class="at">y =</span> estimate,</span>
<span id="cb86-5"><a href="#cb86-5"></a>                      <span class="at">ymin =</span> conf.low, <span class="at">ymax =</span> conf.high)) <span class="sc">+</span></span>
<span id="cb86-6"><a href="#cb86-6"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Treatments"</span>, <span class="at">y =</span> <span class="st">"Average Treatment Effects"</span>) <span class="sc">+</span></span>
<span id="cb86-7"><a href="#cb86-7"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">12</span>)</span></code><button title="コピーする" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-intro-pointrange-4" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="day04_files/figure-html/fig-intro-pointrange-4-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">図&nbsp;11: <strong>?(caption)</strong></figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>　これで処置効果の可視化もバッチリだ。</p>
</section>
<section id="多重比較の問題" class="level3">
<h3 class="anchored" data-anchor-id="多重比較の問題">多重比較の問題</h3>
<p>　グループが2つ、つまり統制群と統制群のみが存在する場合、我々が比較を行う回数は1回のみである（統制群 - 処置群）。しかし、今回のデータの場合、処置群は4つである。これは比較を4回行うことを意味する。具体的には「統制群 - 処置群1」、「統制群 - 処置群2」、「統制群 - 処置群3」、「統制群 - 処置群4」だ。比較を繰り返すほど、統計的に有意な結果が得られる可能性は高い。極端な話、1000回程度検定を繰り返せば、本当は効果がなくても<strong>たまたま</strong>統計的に有意な結果が何回かは得られるだろう。これが多重検定（multiple testing）の問題である。したがって、比較の回数が多くなるにつれ、統計的有意性検定にも何らかのペナルティーを課す必要がある。</p>
<p>　多重比較におけるペナルティーの付け方はいくつかあるが、ここでは最も保守的な（=研究者にとって都合の悪い）補正法であるボンフェローニ補正（Bonferroni correction）を紹介する。これは非常に単純で、<span class="math inline">\(p\)</span>値や信頼区間を計算する際、「統計的有意」と判定されるハードルを上げる方法である。予め決めておいた有意水準（<span class="math inline">\(\alpha\)</span>）が0.05で、比較の回数が4回であれば、<span class="math inline">\(p\)</span>値が<span class="math inline">\(0.05 \times \frac{1}{4} = 0.0125\)</span>を下回る場合において「5%水準で有意である」と判定する。信頼区間でいえば通常の95%信頼区間（1 - 0.05）でなく、98.75%信頼区間（1 - 0.0125）を使うこととなる。この結果、統計的に有意な結果が得られたら「1.25%水準で〜」と解釈するのではなく、「5%水準で〜」と解釈する必要がある。</p>
<p>　95%以外の信頼区間を求めるのは簡単で、<code>tidy()</code>関数内に<code>conf.level</code>を修正すれば良い。指定されていない場合はデフォルトで0.95が割り当てられているが、これを0.9875と修正する。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1"></a>fit1_coef <span class="ot">&lt;-</span> <span class="fu">tidy</span>(fit1, <span class="at">conf.int =</span> <span class="cn">TRUE</span>, <span class="at">conf.level =</span> <span class="fl">0.9875</span>)</span>
<span id="cb87-2"><a href="#cb87-2"></a></span>
<span id="cb87-3"><a href="#cb87-3"></a>fit1_coef</span></code><button title="コピーする" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 7
  term                estimate std.error statistic   p.value conf.low conf.high
  &lt;chr&gt;                  &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
1 (Intercept)           0.299    0.00886    33.7   2.80e-224   0.276     0.321 
2 treatmentCivic Duty   0.0181   0.0214      0.847 3.97e-  1  -0.0353    0.0714
3 treatmentSelf         0.0658   0.0220      2.99  2.80e-  3   0.0108    0.121 
4 treatmentNeighbors    0.122    0.0221      5.53  3.30e-  8   0.0669    0.177 
5 treatmentHawthorne    0.0406   0.0214      1.89  5.82e-  2  -0.0130    0.0942</code></pre>
</div>
</div>
<p>　それでは <a href="#fig-intro-pointrange-4">図&nbsp;11</a> と同じ図を作ってみよう。まず、切片の行を除外するが、ここでは<code>filter()</code>を使わず、<code>slice()</code>の使った方法を紹介する。<code>slice()</code>は<code>()</code>内に指定した行を残す関数だ。たとえば、<code>slice(fit1_coef, 2)</code>なら<code>fit1_coef</code>の2行目のみを残す。<code>fit1_coef</code>は<code>slice()</code>の第1引数だから、パイプ演算子を使うことも可能で、こちらの方を推奨する。そうすれば<code>()</code>内には残す行のみの指定で済む。<code>slice(2)</code>のみなら2行目を残し、<code>slice(1, 3, 5)</code>なら1、3、5行目を残す。<code>:</code>を使うと「〜行目から〜行目まで」の指定ができる。処置効果の係数は<code>fit1_coef</code>の2行目から5行目までなので、<code>2:5</code>と指定すれば良い。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1"></a>fit1_coef <span class="ot">&lt;-</span> fit1_coef <span class="sc">|&gt;</span></span>
<span id="cb89-2"><a href="#cb89-2"></a>  <span class="fu">slice</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">5</span>)</span>
<span id="cb89-3"><a href="#cb89-3"></a></span>
<span id="cb89-4"><a href="#cb89-4"></a>fit1_coef</span></code><button title="コピーする" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 7
  term                estimate std.error statistic      p.value conf.low conf.…¹
  &lt;chr&gt;                  &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;        &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;
1 treatmentCivic Duty   0.0181    0.0214     0.847 0.397         -0.0353  0.0714
2 treatmentSelf         0.0658    0.0220     2.99  0.00280        0.0108  0.121 
3 treatmentNeighbors    0.122     0.0221     5.53  0.0000000330   0.0669  0.177 
4 treatmentHawthorne    0.0406    0.0214     1.89  0.0582        -0.0130  0.0942
# … with abbreviated variable name ¹​conf.high</code></pre>
</div>
</div>
<p>　続いて、<code>term</code>変数の値から<code>"treatment"</code>の文字を除去し、<code>fit1_coef</code>での出力順番で<code>term</code>をfactor化する。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1"></a>fit1_coef <span class="ot">&lt;-</span> fit1_coef <span class="sc">|&gt;</span></span>
<span id="cb91-2"><a href="#cb91-2"></a>  <span class="fu">mutate</span>(<span class="at">term =</span> <span class="fu">recode</span>(term,</span>
<span id="cb91-3"><a href="#cb91-3"></a>                       <span class="st">"treatmentCivic Duty"</span> <span class="ot">=</span> <span class="st">"Civic Duty"</span>,</span>
<span id="cb91-4"><a href="#cb91-4"></a>                       <span class="st">"treatmentHawthorne"</span>  <span class="ot">=</span> <span class="st">"Hawthorne"</span>,</span>
<span id="cb91-5"><a href="#cb91-5"></a>                       <span class="st">"treatmentNeighbors"</span>  <span class="ot">=</span> <span class="st">"Neighbors"</span>,</span>
<span id="cb91-6"><a href="#cb91-6"></a>                       <span class="st">"treatmentSelf"</span>       <span class="ot">=</span> <span class="st">"Self"</span>),</span>
<span id="cb91-7"><a href="#cb91-7"></a>         <span class="at">term =</span> <span class="fu">fct_inorder</span>(term))</span>
<span id="cb91-8"><a href="#cb91-8"></a></span>
<span id="cb91-9"><a href="#cb91-9"></a>fit1_coef</span></code><button title="コピーする" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 7
  term       estimate std.error statistic      p.value conf.low conf.high
  &lt;fct&gt;         &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;        &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
1 Civic Duty   0.0181    0.0214     0.847 0.397         -0.0353    0.0714
2 Self         0.0658    0.0220     2.99  0.00280        0.0108    0.121 
3 Neighbors    0.122     0.0221     5.53  0.0000000330   0.0669    0.177 
4 Hawthorne    0.0406    0.0214     1.89  0.0582        -0.0130    0.0942</code></pre>
</div>
</div>
<p>　最後に <a href="#fig-intro-pointrange-4">図&nbsp;11</a> と同じコードで作図する。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1"></a>fit1_coef <span class="sc">|&gt;</span></span>
<span id="cb93-2"><a href="#cb93-2"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb93-3"><a href="#cb93-3"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb93-4"><a href="#cb93-4"></a>  <span class="fu">geom_pointrange</span>(<span class="fu">aes</span>(<span class="at">x =</span> term, <span class="at">y =</span> estimate,</span>
<span id="cb93-5"><a href="#cb93-5"></a>                      <span class="at">ymin =</span> conf.low, <span class="at">ymax =</span> conf.high)) <span class="sc">+</span></span>
<span id="cb93-6"><a href="#cb93-6"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Treatments"</span>, </span>
<span id="cb93-7"><a href="#cb93-7"></a>       <span class="at">y =</span> <span class="st">"Average Treatment Effects (w/ 98.75% CI)"</span>) <span class="sc">+</span></span>
<span id="cb93-8"><a href="#cb93-8"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">12</span>)</span></code><button title="コピーする" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-intro-pointrange-5" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="day04_files/figure-html/fig-intro-pointrange-5-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">図&nbsp;12: <strong>?(caption)</strong></figcaption><p></p>
</figure>
</div>
</div>
</div>
</section>
<section id="統計的推定重回帰分析" class="level3">
<h3 class="anchored" data-anchor-id="統計的推定重回帰分析">統計的推定（重回帰分析）</h3>
<p>　今回の例は無作為割当が成功しており、処置前変数の偏りは見られない。しかし、何らかの理由で処置前変数の偏りが生じる場合がある。その「何らかの理由」が応答変数にまで影響を与えるのであれば、それは交絡変数（confounder）となり、バイアスの原因となる。この場合、偏りが生じている処置前変数を統制（control）することによってバイアスを小さくすることができる。今回は不要であるが、性別や誕生年などの共変量を統制した推定をしてみよう。</p>
<p>　やり方は簡単で、<code>lm()</code>内の回帰式を<code>応答変数 ~ 説明変数1 + 説明変数2 + ...</code>のように説明変数を<code>+</code>で足していけば良い。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1"></a>fit2 <span class="ot">&lt;-</span><span class="fu">lm</span>(voted2006 <span class="sc">~</span> treatment <span class="sc">+</span> female <span class="sc">+</span> yob <span class="sc">+</span> hh_size <span class="sc">+</span></span>
<span id="cb94-2"><a href="#cb94-2"></a>            voted2000 <span class="sc">+</span> voted2002 <span class="sc">+</span> voted2004, <span class="at">data =</span> df)</span>
<span id="cb94-3"><a href="#cb94-3"></a></span>
<span id="cb94-4"><a href="#cb94-4"></a><span class="fu">summary</span>(fit2)</span></code><button title="コピーする" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = voted2006 ~ treatment + female + yob + hh_size + 
    voted2000 + voted2002 + voted2004, data = df)

Residuals:
    Min      1Q  Median      3Q     Max 
-0.7573 -0.3447 -0.1953  0.5184  0.9506 

Coefficients:
                      Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)          6.0886118  0.9164461   6.644 3.39e-11 ***
treatmentCivic Duty  0.0307108  0.0205474   1.495 0.135074    
treatmentSelf        0.0703356  0.0211562   3.325 0.000892 ***
treatmentNeighbors   0.1147107  0.0212088   5.409 6.65e-08 ***
treatmentHawthorne   0.0423327  0.0206241   2.053 0.040165 *  
female              -0.0240666  0.0127276  -1.891 0.058696 .  
yob                 -0.0030326  0.0004705  -6.445 1.27e-10 ***
hh_size              0.0025215  0.0085056   0.296 0.766896    
voted2000            0.0666981  0.0147950   4.508 6.69e-06 ***
voted2002            0.1644528  0.0133278  12.339  &lt; 2e-16 ***
voted2004            0.1583835  0.0130339  12.152  &lt; 2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.449 on 4989 degrees of freedom
Multiple R-squared:  0.08363,   Adjusted R-squared:  0.0818 
F-statistic: 45.53 on 10 and 4989 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<p>　{modelsummary}パッケージの<code>modelsummary()</code>関数を使えば、推定結果がより見やすくなる。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1"></a><span class="fu">modelsummary</span>(fit2)</span></code><button title="コピーする" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<table class="table" style="width: auto !important; margin-left: auto; margin-right: auto;">
 <thead>
  <tr>
   <th style="text-align:left;">   </th>
   <th style="text-align:center;"> Model 1 </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> (Intercept) </td>
   <td style="text-align:center;"> 6.089 </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;"> (0.916) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> treatmentCivic Duty </td>
   <td style="text-align:center;"> 0.031 </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;"> (0.021) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> treatmentSelf </td>
   <td style="text-align:center;"> 0.070 </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;"> (0.021) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> treatmentNeighbors </td>
   <td style="text-align:center;"> 0.115 </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;"> (0.021) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> treatmentHawthorne </td>
   <td style="text-align:center;"> 0.042 </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;"> (0.021) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> female </td>
   <td style="text-align:center;"> −0.024 </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;"> (0.013) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> yob </td>
   <td style="text-align:center;"> −0.003 </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;"> (0.000) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> hh_size </td>
   <td style="text-align:center;"> 0.003 </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;"> (0.009) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> voted2000 </td>
   <td style="text-align:center;"> 0.067 </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;"> (0.015) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> voted2002 </td>
   <td style="text-align:center;"> 0.164 </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;"> (0.013) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> voted2004 </td>
   <td style="text-align:center;"> 0.158 </td>
  </tr>
  <tr>
   <td style="text-align:left;box-shadow: 0px 1px">  </td>
   <td style="text-align:center;box-shadow: 0px 1px"> (0.013) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Num.Obs. </td>
   <td style="text-align:center;"> 5000 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> R2 </td>
   <td style="text-align:center;"> 0.084 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> R2 Adj. </td>
   <td style="text-align:center;"> 0.082 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> AIC </td>
   <td style="text-align:center;"> 6195.0 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> BIC </td>
   <td style="text-align:center;"> 6273.2 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Log.Lik. </td>
   <td style="text-align:center;"> −3085.506 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> F </td>
   <td style="text-align:center;"> 45.533 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> RMSE </td>
   <td style="text-align:center;"> 0.45 </td>
  </tr>
</tbody>
</table>

</div>
</div>
<p>　また、複数のモデルを<code>list()</code>関数でまとめると、モデル間比較もできる。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1"></a><span class="fu">modelsummary</span>(<span class="fu">list</span>(<span class="st">"w/o Covariates"</span> <span class="ot">=</span> fit1, <span class="st">"w/ Covariates"</span> <span class="ot">=</span> fit2))</span></code><button title="コピーする" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<table class="table" style="width: auto !important; margin-left: auto; margin-right: auto;">
 <thead>
  <tr>
   <th style="text-align:left;">   </th>
   <th style="text-align:center;"> w/o Covariates </th>
   <th style="text-align:center;"> w/ Covariates </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> (Intercept) </td>
   <td style="text-align:center;"> 0.299 </td>
   <td style="text-align:center;"> 6.089 </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;"> (0.009) </td>
   <td style="text-align:center;"> (0.916) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> treatmentCivic Duty </td>
   <td style="text-align:center;"> 0.018 </td>
   <td style="text-align:center;"> 0.031 </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;"> (0.021) </td>
   <td style="text-align:center;"> (0.021) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> treatmentSelf </td>
   <td style="text-align:center;"> 0.066 </td>
   <td style="text-align:center;"> 0.070 </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;"> (0.022) </td>
   <td style="text-align:center;"> (0.021) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> treatmentNeighbors </td>
   <td style="text-align:center;"> 0.122 </td>
   <td style="text-align:center;"> 0.115 </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;"> (0.022) </td>
   <td style="text-align:center;"> (0.021) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> treatmentHawthorne </td>
   <td style="text-align:center;"> 0.041 </td>
   <td style="text-align:center;"> 0.042 </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;"> (0.021) </td>
   <td style="text-align:center;"> (0.021) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> female </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> −0.024 </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> (0.013) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> yob </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> −0.003 </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> (0.000) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> hh_size </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> 0.003 </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> (0.009) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> voted2000 </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> 0.067 </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> (0.015) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> voted2002 </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> 0.164 </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> (0.013) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> voted2004 </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> 0.158 </td>
  </tr>
  <tr>
   <td style="text-align:left;box-shadow: 0px 1px">  </td>
   <td style="text-align:center;box-shadow: 0px 1px">  </td>
   <td style="text-align:center;box-shadow: 0px 1px"> (0.013) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Num.Obs. </td>
   <td style="text-align:center;"> 5000 </td>
   <td style="text-align:center;"> 5000 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> R2 </td>
   <td style="text-align:center;"> 0.007 </td>
   <td style="text-align:center;"> 0.084 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> R2 Adj. </td>
   <td style="text-align:center;"> 0.006 </td>
   <td style="text-align:center;"> 0.082 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> AIC </td>
   <td style="text-align:center;"> 6584.0 </td>
   <td style="text-align:center;"> 6195.0 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> BIC </td>
   <td style="text-align:center;"> 6623.1 </td>
   <td style="text-align:center;"> 6273.2 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Log.Lik. </td>
   <td style="text-align:center;"> −3285.982 </td>
   <td style="text-align:center;"> −3085.506 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> F </td>
   <td style="text-align:center;"> 8.959 </td>
   <td style="text-align:center;"> 45.533 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> RMSE </td>
   <td style="text-align:center;"> 0.47 </td>
   <td style="text-align:center;"> 0.45 </td>
  </tr>
</tbody>
</table>

</div>
</div>
<p>　<code>modelsummary()</code>は推定値と標準誤差（カッコ内）が別々の行として出力する。これを一行でまとめるためには、以下のようにコードを修正する。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1"></a><span class="fu">modelsummary</span>(<span class="fu">list</span>(<span class="st">"w/o Covariates"</span> <span class="ot">=</span> fit1, <span class="st">"w/ Covariates"</span> <span class="ot">=</span> fit2),</span>
<span id="cb98-2"><a href="#cb98-2"></a>             <span class="at">estimate  =</span> <span class="st">"{estimate} ({std.error})"</span>,</span>
<span id="cb98-3"><a href="#cb98-3"></a>             <span class="at">statistic =</span> <span class="cn">NULL</span>)</span></code><button title="コピーする" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<table class="table" style="width: auto !important; margin-left: auto; margin-right: auto;">
 <thead>
  <tr>
   <th style="text-align:left;">   </th>
   <th style="text-align:center;"> w/o Covariates </th>
   <th style="text-align:center;"> w/ Covariates </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> (Intercept) </td>
   <td style="text-align:center;"> 0.299 (0.009) </td>
   <td style="text-align:center;"> 6.089 (0.916) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> treatmentCivic Duty </td>
   <td style="text-align:center;"> 0.018 (0.021) </td>
   <td style="text-align:center;"> 0.031 (0.021) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> treatmentSelf </td>
   <td style="text-align:center;"> 0.066 (0.022) </td>
   <td style="text-align:center;"> 0.070 (0.021) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> treatmentNeighbors </td>
   <td style="text-align:center;"> 0.122 (0.022) </td>
   <td style="text-align:center;"> 0.115 (0.021) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> treatmentHawthorne </td>
   <td style="text-align:center;"> 0.041 (0.021) </td>
   <td style="text-align:center;"> 0.042 (0.021) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> female </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> −0.024 (0.013) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> yob </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> −0.003 (0.000) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> hh_size </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> 0.003 (0.009) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> voted2000 </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> 0.067 (0.015) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> voted2002 </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> 0.164 (0.013) </td>
  </tr>
  <tr>
   <td style="text-align:left;box-shadow: 0px 1px"> voted2004 </td>
   <td style="text-align:center;box-shadow: 0px 1px">  </td>
   <td style="text-align:center;box-shadow: 0px 1px"> 0.158 (0.013) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Num.Obs. </td>
   <td style="text-align:center;"> 5000 </td>
   <td style="text-align:center;"> 5000 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> R2 </td>
   <td style="text-align:center;"> 0.007 </td>
   <td style="text-align:center;"> 0.084 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> R2 Adj. </td>
   <td style="text-align:center;"> 0.006 </td>
   <td style="text-align:center;"> 0.082 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> AIC </td>
   <td style="text-align:center;"> 6584.0 </td>
   <td style="text-align:center;"> 6195.0 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> BIC </td>
   <td style="text-align:center;"> 6623.1 </td>
   <td style="text-align:center;"> 6273.2 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Log.Lik. </td>
   <td style="text-align:center;"> −3285.982 </td>
   <td style="text-align:center;"> −3085.506 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> F </td>
   <td style="text-align:center;"> 8.959 </td>
   <td style="text-align:center;"> 45.533 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> RMSE </td>
   <td style="text-align:center;"> 0.47 </td>
   <td style="text-align:center;"> 0.45 </td>
  </tr>
</tbody>
</table>

</div>
</div>
<p>　また、<code>align</code>で各列を左寄せや右寄せに（文字列は左寄せ、数値は右寄せが一般的）、<code>coef_rename</code>引数で表示される変数名を変更することもできる。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1"></a><span class="fu">modelsummary</span>(<span class="fu">list</span>(<span class="st">"w/o Covariates"</span> <span class="ot">=</span> fit1, <span class="st">"w/ Covariates"</span> <span class="ot">=</span> fit2),</span>
<span id="cb99-2"><a href="#cb99-2"></a>             <span class="at">estimate  =</span> <span class="st">"{estimate} ({std.error})"</span>,</span>
<span id="cb99-3"><a href="#cb99-3"></a>             <span class="at">statistic =</span> <span class="cn">NULL</span>,</span>
<span id="cb99-4"><a href="#cb99-4"></a>             <span class="at">align =</span> <span class="st">"lrr"</span>, <span class="co"># 1列は左寄せ、2列は右寄せ、3列は右寄せ</span></span>
<span id="cb99-5"><a href="#cb99-5"></a>             <span class="at">coef_rename =</span> <span class="fu">c</span>(<span class="st">"treatmentCivic Duty"</span> <span class="ot">=</span> <span class="st">"Civic Duty"</span>,</span>
<span id="cb99-6"><a href="#cb99-6"></a>                             <span class="st">"treatmentSelf"</span>       <span class="ot">=</span> <span class="st">"Self"</span>,</span>
<span id="cb99-7"><a href="#cb99-7"></a>                             <span class="st">"treatmentNeighbors"</span>  <span class="ot">=</span> <span class="st">"Neighbors"</span>,</span>
<span id="cb99-8"><a href="#cb99-8"></a>                             <span class="st">"treatmentHawthorne"</span>  <span class="ot">=</span> <span class="st">"Hawthorne"</span>,</span>
<span id="cb99-9"><a href="#cb99-9"></a>                             <span class="st">"female"</span>              <span class="ot">=</span> <span class="st">"Female"</span>,</span>
<span id="cb99-10"><a href="#cb99-10"></a>                             <span class="st">"yob"</span>                 <span class="ot">=</span> <span class="st">"Year of Birth"</span>,</span>
<span id="cb99-11"><a href="#cb99-11"></a>                             <span class="st">"hh_size"</span>             <span class="ot">=</span> <span class="st">"Household Size"</span>,</span>
<span id="cb99-12"><a href="#cb99-12"></a>                             <span class="st">"voted2000"</span>           <span class="ot">=</span> <span class="st">"Voted (2000)"</span>,</span>
<span id="cb99-13"><a href="#cb99-13"></a>                             <span class="st">"voted2002"</span>           <span class="ot">=</span> <span class="st">"Voted (2002)"</span>,</span>
<span id="cb99-14"><a href="#cb99-14"></a>                             <span class="st">"voted2004"</span>           <span class="ot">=</span> <span class="st">"Voted (2004)"</span>))</span></code><button title="コピーする" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<table class="table" style="width: auto !important; margin-left: auto; margin-right: auto;">
 <thead>
  <tr>
   <th style="text-align:left;">   </th>
   <th style="text-align:right;"> w/o Covariates </th>
   <th style="text-align:right;"> w/ Covariates </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> (Intercept) </td>
   <td style="text-align:right;"> 0.299 (0.009) </td>
   <td style="text-align:right;"> 6.089 (0.916) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Civic Duty </td>
   <td style="text-align:right;"> 0.018 (0.021) </td>
   <td style="text-align:right;"> 0.031 (0.021) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Self </td>
   <td style="text-align:right;"> 0.066 (0.022) </td>
   <td style="text-align:right;"> 0.070 (0.021) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Neighbors </td>
   <td style="text-align:right;"> 0.122 (0.022) </td>
   <td style="text-align:right;"> 0.115 (0.021) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Hawthorne </td>
   <td style="text-align:right;"> 0.041 (0.021) </td>
   <td style="text-align:right;"> 0.042 (0.021) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Female </td>
   <td style="text-align:right;">  </td>
   <td style="text-align:right;"> −0.024 (0.013) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Year of Birth </td>
   <td style="text-align:right;">  </td>
   <td style="text-align:right;"> −0.003 (0.000) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Household Size </td>
   <td style="text-align:right;">  </td>
   <td style="text-align:right;"> 0.003 (0.009) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Voted (2000) </td>
   <td style="text-align:right;">  </td>
   <td style="text-align:right;"> 0.067 (0.015) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Voted (2002) </td>
   <td style="text-align:right;">  </td>
   <td style="text-align:right;"> 0.164 (0.013) </td>
  </tr>
  <tr>
   <td style="text-align:left;box-shadow: 0px 1px"> Voted (2004) </td>
   <td style="text-align:right;box-shadow: 0px 1px">  </td>
   <td style="text-align:right;box-shadow: 0px 1px"> 0.158 (0.013) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Num.Obs. </td>
   <td style="text-align:right;"> 5000 </td>
   <td style="text-align:right;"> 5000 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> R2 </td>
   <td style="text-align:right;"> 0.007 </td>
   <td style="text-align:right;"> 0.084 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> R2 Adj. </td>
   <td style="text-align:right;"> 0.006 </td>
   <td style="text-align:right;"> 0.082 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> AIC </td>
   <td style="text-align:right;"> 6584.0 </td>
   <td style="text-align:right;"> 6195.0 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> BIC </td>
   <td style="text-align:right;"> 6623.1 </td>
   <td style="text-align:right;"> 6273.2 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Log.Lik. </td>
   <td style="text-align:right;"> −3285.982 </td>
   <td style="text-align:right;"> −3085.506 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> F </td>
   <td style="text-align:right;"> 8.959 </td>
   <td style="text-align:right;"> 45.533 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> RMSE </td>
   <td style="text-align:right;"> 0.47 </td>
   <td style="text-align:right;"> 0.45 </td>
  </tr>
</tbody>
</table>

</div>
</div>
<p>　処置効果に注目すると、共変量の有無が推定結果に影響をほぼ与えないことが分かる。これは無作為割当に成功したことを意味する。</p>
</section>
</section>
<section id="番外編" class="level2">
<h2 class="anchored" data-anchor-id="番外編">番外編</h2>
<p>　<code>modelsummary()</code>を使えば、複数のモデルの推定結果を一つの表としてまとめられる。しかし、図の場合はどうだろう。共変量なしモデルとありモデルを <a href="#fig-intro-pointrange-5">図&nbsp;12</a> のように一つにまとめることはできるだろうか。もちろん出来る。</p>
<p>　まず、重回帰分析を行った結果（<code>fit2</code>）から処置効果の推定値情報を抽出し、<code>fit1_coef</code>と同じ構造のデータとしてまとめる。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1"></a>fit2_coef <span class="ot">&lt;-</span> <span class="fu">tidy</span>(fit2, <span class="at">conf.int =</span> <span class="cn">TRUE</span>, <span class="at">conf.level =</span> <span class="fl">0.9875</span>)</span>
<span id="cb100-2"><a href="#cb100-2"></a></span>
<span id="cb100-3"><a href="#cb100-3"></a>fit2_coef <span class="ot">&lt;-</span> fit2_coef <span class="sc">|&gt;</span></span>
<span id="cb100-4"><a href="#cb100-4"></a>  <span class="fu">slice</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">5</span>) <span class="sc">|&gt;</span></span>
<span id="cb100-5"><a href="#cb100-5"></a>  <span class="fu">mutate</span>(<span class="at">term =</span> <span class="fu">recode</span>(term,</span>
<span id="cb100-6"><a href="#cb100-6"></a>                       <span class="st">"treatmentCivic Duty"</span> <span class="ot">=</span> <span class="st">"Civic Duty"</span>,</span>
<span id="cb100-7"><a href="#cb100-7"></a>                       <span class="st">"treatmentHawthorne"</span>  <span class="ot">=</span> <span class="st">"Hawthorne"</span>,</span>
<span id="cb100-8"><a href="#cb100-8"></a>                       <span class="st">"treatmentNeighbors"</span>  <span class="ot">=</span> <span class="st">"Neighbors"</span>,</span>
<span id="cb100-9"><a href="#cb100-9"></a>                       <span class="st">"treatmentSelf"</span>       <span class="ot">=</span> <span class="st">"Self"</span>),</span>
<span id="cb100-10"><a href="#cb100-10"></a>         <span class="at">term =</span> <span class="fu">fct_inorder</span>(term))</span>
<span id="cb100-11"><a href="#cb100-11"></a></span>
<span id="cb100-12"><a href="#cb100-12"></a>fit2_coef</span></code><button title="コピーする" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 7
  term       estimate std.error statistic      p.value conf.low conf.high
  &lt;fct&gt;         &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;        &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
1 Civic Duty   0.0307    0.0205      1.49 0.135        -0.0206     0.0821
2 Self         0.0703    0.0212      3.32 0.000892      0.0175     0.123 
3 Neighbors    0.115     0.0212      5.41 0.0000000665  0.0617     0.168 
4 Hawthorne    0.0423    0.0206      2.05 0.0402       -0.00920    0.0939</code></pre>
</div>
</div>
<p>　処置効果の推定値や標準誤差などが異なるが、構造としては同じである。続いて、<code>bind_rows()</code>を用い、この2つのデータを一つの表として結合する。2つの表は<code>list()</code>関数でまとめるが、それぞれ<code>"モデル名" = データ名</code>と指定する。最後に、<code>.id = "Model"</code>を追加する。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1"></a><span class="fu">bind_rows</span>(<span class="fu">list</span>(<span class="st">"Model 1"</span> <span class="ot">=</span> fit1_coef, </span>
<span id="cb102-2"><a href="#cb102-2"></a>               <span class="st">"Model 2"</span> <span class="ot">=</span> fit2_coef),</span>
<span id="cb102-3"><a href="#cb102-3"></a>          <span class="at">.id =</span> <span class="st">"Model"</span>)</span></code><button title="コピーする" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 8 × 8
  Model   term       estimate std.error statistic      p.value conf.low conf.h…¹
  &lt;chr&gt;   &lt;fct&gt;         &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;        &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;
1 Model 1 Civic Duty   0.0181    0.0214     0.847 0.397        -0.0353    0.0714
2 Model 1 Self         0.0658    0.0220     2.99  0.00280       0.0108    0.121 
3 Model 1 Neighbors    0.122     0.0221     5.53  0.0000000330  0.0669    0.177 
4 Model 1 Hawthorne    0.0406    0.0214     1.89  0.0582       -0.0130    0.0942
5 Model 2 Civic Duty   0.0307    0.0205     1.49  0.135        -0.0206    0.0821
6 Model 2 Self         0.0703    0.0212     3.32  0.000892      0.0175    0.123 
7 Model 2 Neighbors    0.115     0.0212     5.41  0.0000000665  0.0617    0.168 
8 Model 2 Hawthorne    0.0423    0.0206     2.05  0.0402       -0.00920   0.0939
# … with abbreviated variable name ¹​conf.high</code></pre>
</div>
</div>
<p>　2つの表が1つとなり、<code>Model</code>という列が追加される（これは<code>.id</code>で指定した名前）。そして、<code>fit1_coef</code>だった行は<code>"Model 1"</code>、<code>fit2_coef</code>だった行は<code>"Model 2"</code>が付く。ただし、これだけだと表が結合されて出力される<strong>だけ</strong>なので、<code>fit_coef</code>という名のオブジェクトとして作業環境内に格納しておく。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1"></a>fit_coef <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(<span class="fu">list</span>(<span class="st">"Model 1"</span> <span class="ot">=</span> fit1_coef, </span>
<span id="cb104-2"><a href="#cb104-2"></a>                           <span class="st">"Model 2"</span> <span class="ot">=</span> fit2_coef),</span>
<span id="cb104-3"><a href="#cb104-3"></a>                      <span class="at">.id =</span> <span class="st">"Model"</span>)</span></code><button title="コピーする" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>　それでは<code>fit_coef</code>を使って、作図をしてみよう。コードは <a href="#fig-intro-pointrange-5">図&nbsp;12</a> と同じであるが、<code>facet_wrap()</code>レイヤーを追加する。これはグラフのファセット（facet）分割を意味し、ファセットとは「面」を意味する。<code>()</code>内には<code>~分割の基準となる変数名</code>を入れる。2つのモデルがあり、<code>fit_coef</code>だと<code>Model</code>列がどのモデルの推定値かを示している。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1"></a>fit_coef <span class="sc">|&gt;</span></span>
<span id="cb105-2"><a href="#cb105-2"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb105-3"><a href="#cb105-3"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb105-4"><a href="#cb105-4"></a>  <span class="fu">geom_pointrange</span>(<span class="fu">aes</span>(<span class="at">x =</span> term, <span class="at">y =</span> estimate,</span>
<span id="cb105-5"><a href="#cb105-5"></a>                      <span class="at">ymin =</span> conf.low, <span class="at">ymax =</span> conf.high)) <span class="sc">+</span></span>
<span id="cb105-6"><a href="#cb105-6"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Treatments"</span>, <span class="at">y =</span> <span class="st">"Average Treatment Effects"</span>) <span class="sc">+</span></span>
<span id="cb105-7"><a href="#cb105-7"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> Model) <span class="sc">+</span></span>
<span id="cb105-8"><a href="#cb105-8"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">12</span>)</span></code><button title="コピーする" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-intro-pointrange-6" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="day04_files/figure-html/fig-intro-pointrange-6-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">図&nbsp;13: <strong>?(caption)</strong></figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>　今回の結果だとモデル1もモデル2も推定値がほぼ同じである。ファセット分割の場合、小さい差の比較が難しいというデメリットがある。この場合、ファセット分割をせず、一つのファセットにpoint-rangeの色分けした方が読みやすくなる。point-rangeを<code>Model</code>の値に応じて色分けする場合、<code>aes()</code>内に<code>color = Model</code>を追加する。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1"></a>fit_coef <span class="sc">|&gt;</span></span>
<span id="cb106-2"><a href="#cb106-2"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb106-3"><a href="#cb106-3"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb106-4"><a href="#cb106-4"></a>  <span class="fu">geom_pointrange</span>(<span class="fu">aes</span>(<span class="at">x =</span> term, <span class="at">y =</span> estimate,</span>
<span id="cb106-5"><a href="#cb106-5"></a>                      <span class="at">ymin =</span> conf.low, <span class="at">ymax =</span> conf.high,</span>
<span id="cb106-6"><a href="#cb106-6"></a>                      <span class="at">color =</span> Model)) <span class="sc">+</span></span>
<span id="cb106-7"><a href="#cb106-7"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Treatments"</span>, <span class="at">y =</span> <span class="st">"Average Treatment Effects"</span>) <span class="sc">+</span></span>
<span id="cb106-8"><a href="#cb106-8"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">12</span>)</span></code><button title="コピーする" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-intro-pointrange-7" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="day04_files/figure-html/fig-intro-pointrange-7-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">図&nbsp;14: <strong>?(caption)</strong></figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>　何かおかしい。point-rangeの横軸上の位置が同じということから重なってしまい、モデル1のpoint-rangeがよく見えない。これをずらすために<code>aes()</code>の<strong>外</strong>側に<code>position = position_dodge2(1/2)</code>を追加する。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1"></a>fit_coef <span class="sc">|&gt;</span></span>
<span id="cb107-2"><a href="#cb107-2"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb107-3"><a href="#cb107-3"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb107-4"><a href="#cb107-4"></a>  <span class="fu">geom_pointrange</span>(<span class="fu">aes</span>(<span class="at">x =</span> term, <span class="at">y =</span> estimate,</span>
<span id="cb107-5"><a href="#cb107-5"></a>                      <span class="at">ymin =</span> conf.low, <span class="at">ymax =</span> conf.high,</span>
<span id="cb107-6"><a href="#cb107-6"></a>                      <span class="at">color =</span> Model),</span>
<span id="cb107-7"><a href="#cb107-7"></a>                  <span class="at">position =</span> <span class="fu">position_dodge2</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb107-8"><a href="#cb107-8"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Treatments"</span>, <span class="at">y =</span> <span class="st">"Average Treatment Effects"</span>) <span class="sc">+</span></span>
<span id="cb107-9"><a href="#cb107-9"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">12</span>)</span></code><button title="コピーする" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-intro-pointrange-8" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="day04_files/figure-html/fig-intro-pointrange-8-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">図&nbsp;15: <strong>?(caption)</strong></figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>　これで図は完成だが、少し修正してみよう。{ggplot2}の場合、凡例は右側に表示されるが、これを下側へ移動させるためには<code>theme()</code>レイヤーを追加し、<code>legend.position = "bottom"</code>を指定する。また、モデル1とモデル2が具体的に何を意味するのかを明確に示したい。これは<code>fit_coef</code>の<code>Model</code>列を修正しても良いが、今回は<code>scale_color_discrete()</code>レイヤーで修正する例を紹介する。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1"></a>fit_coef <span class="sc">|&gt;</span></span>
<span id="cb108-2"><a href="#cb108-2"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb108-3"><a href="#cb108-3"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb108-4"><a href="#cb108-4"></a>  <span class="fu">geom_pointrange</span>(<span class="fu">aes</span>(<span class="at">x =</span> term, <span class="at">y =</span> estimate,</span>
<span id="cb108-5"><a href="#cb108-5"></a>                      <span class="at">ymin =</span> conf.low, <span class="at">ymax =</span> conf.high,</span>
<span id="cb108-6"><a href="#cb108-6"></a>                      <span class="at">color =</span> Model),</span>
<span id="cb108-7"><a href="#cb108-7"></a>                  <span class="at">position =</span> <span class="fu">position_dodge2</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb108-8"><a href="#cb108-8"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Treatments"</span>, <span class="at">y =</span> <span class="st">"Average Treatment Effects"</span>) <span class="sc">+</span></span>
<span id="cb108-9"><a href="#cb108-9"></a>  <span class="fu">scale_color_discrete</span>(<span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Model 1"</span> <span class="ot">=</span> <span class="st">"w/o Covariates"</span>,</span>
<span id="cb108-10"><a href="#cb108-10"></a>                                  <span class="st">"Model 2"</span> <span class="ot">=</span> <span class="st">"w/ Covariates"</span>)) <span class="sc">+</span></span>
<span id="cb108-11"><a href="#cb108-11"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">12</span>) <span class="sc">+</span></span>
<span id="cb108-12"><a href="#cb108-12"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span></code><button title="コピーする" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-intro-pointrange-9" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="day04_files/figure-html/fig-intro-pointrange-9-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">図&nbsp;16: <strong>?(caption)</strong></figcaption><p></p>
</figure>
</div>
</div>
</div>


</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">注</h2>

<ol>
<li id="fn1"><p>パッケージのアップデートには<code>pacman::p_update()</code>または<code>pacman::p_up()</code>関数を使う。<code>()</code>内に何も入力しない場合、全パッケージがアップデートされる。<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>使用するデータはGerber, Green, and Larimer (2010)のデータである。実際のサンプルサイズは約34万であるが、ここでは無作為に5000個を抽出したサンプルを用いる。抽出前のデータは<a href="https://isps.yale.edu/research/data/d008">Yale ISPS</a>から入手可能である。<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>変数のデータ型はデータを出力する際、列名の下段に表示される。<code>&lt;chr&gt;</code>は文字型、<code>&lt;dbl&gt;</code>と<code>&lt;int&gt;</code>は数値型、<code>&lt;fct&gt;</code>はfactor型である。他にもいくつかのデータ型がある。詳細は『私たちのR』の<a href="https://www.jaysong.net/RBook/datatype.html">第8章</a>を参照すること。<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn4"><p>RMarkdown内に埋め込むなら更に<code>style = "rmarkdown"</code>を追加してみよう。ただし、Chunkオプションに<code>results = "asis"</code>（Quartoなら<code>#| results: "asis"</code>）を付けること。<a href="#fnref4" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn5"><p>中身が1、2、3、…であってもfactor型であれば1、2、3、…は数字でなく文字として認識される。<a href="#fnref5" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn6"><p>もっと使いやすい<code>round()</code>があるが、<code>round()</code>の場合、丸めた結果が1.100なら1.1としか表記されない。表示される桁数を固定するためには<code>sprintf()</code>を使う。<a href="#fnref6" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var filterRegex = new RegExp(/https:\/\/www\.jaysong\.net\/kandai-ci\//);
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
    var links = window.document.querySelectorAll('a:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
          // target, if specified
          link.setAttribute("target", "_blank");
          // default icon
          link.classList.add("external");
      }
    }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../material/day03.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">無作為化比較試験</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../material/day06.html" class="pagination-link">
        <span class="nav-page-text">回帰分析と因果推論</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">Copyright 2022, <a href="https://www.jaysong.net" target="_blank">Jaehyun Song</a>. Powered by <a href="https://quarto.org/" target="_blank">Quarto</a></div>   
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://www.jaysong.net">
      <i class="bi bi-house-fill" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/JaehyunSong">
      <i class="bi bi-github" role="img">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>



</body></html>